(function(n){typeof define=="function"?window.define.amd?window.define("JEditor",["jquery"],n):window.define.cmd?window.define(function(){return n}):n(window.jQuery):typeof module=="object"&&typeof module.exports=="object"?module.exports=n(require("./JEditor-jquery.js")):n(window.jQuery)})(function(n){if(!n||!n.fn||!n.fn.jquery){alert("在引用JEditor.js之前，先引用jQuery，否则无法使用 JEditor");return}var t=function(t){var i=window.JEditor;i&&t(i,n)};return function(n,t){if(n.JEditor){alert("一个页面不能重复引用 JEditor.js 或 JEditor.min.js ！！！");return}var i=function(n){var i,r;(typeof n=="string"&&(n="#"+n),i=t(n),i.length===1)&&(r=i[0].nodeName,r==="TEXTAREA"||r==="DIV")&&(this.valueNodeName=r.toLowerCase(),this.$valueContainer=i,this.$prev=i.prev(),this.$parent=i.parent(),this.init())};i.fn=i.prototype;i.$body=t("body");i.$document=t(document);i.$window=t(n);i.userAgent=navigator.userAgent;i.getComputedStyle=n.getComputedStyle;i.w3cRange=typeof document.createRange=="function";i.hostname=location.hostname.toLowerCase();i.websiteHost="wangeditor.github.io";i.isOnWebsite=i.hostname===i.websiteHost;i.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961";n.JEditor=i;i.plugin=function(n){i._plugins||(i._plugins=[]);typeof n=="function"&&i._plugins.push(n)}}(window,n),t(function(n){n.fn.init=function(){this.initDefaultConfig();this.addEditorContainer();this.addTxt();this.addMenuContainer();this.menus={};this.commandHooks()}}),t(function(n,t){n.fn.ready=function(n){this.readyFns||(this.readyFns=[]);this.readyFns.push(n)};n.fn.readyHeadler=function(){for(var n=this.readyFns;n.length;)n.shift().call(this)};n.fn.updateValue=function(){var n=this,t=n.$valueContainer,i=n.txt.$txt,r;t!==i&&(r=i.html(),t.val(r))};n.fn.getInitValue=function(){var t=this,i=t.$valueContainer,n="",r=t.valueNodeName;return r==="div"?n=i.html():r==="textarea"&&(n=i.val()),n};n.fn.updateMenuStyle=function(){var n=this.menus;t.each(n,function(n,t){t.updateSelected()})};n.fn.enableMenusExcept=function(n){this._disabled||(n=n||[],typeof n=="string"&&(n=[n]),t.each(this.menus,function(t,i){n.indexOf(t)>=0||i.disabled(!1)}))};n.fn.disableMenusExcept=function(n){this._disabled||(n=n||[],typeof n=="string"&&(n=[n]),t.each(this.menus,function(t,i){n.indexOf(t)>=0||i.disabled(!0)}))};n.fn.hideDropPanelAndModal=function(){var n=this.menus;t.each(n,function(n,t){var i=t.dropPanel||t.dropList||t.modal;i&&i.hide&&i.hide()})}}),t(function(n,t){function r(){}var i=!n.w3cRange;n.fn.currentRange=function(n){if(n)this._rangeData=n;else return this._rangeData};n.fn.collapseRange=function(n,t){t=t||"end";t=t==="start"?!0:!1;n=n||this.currentRange();n&&(n.collapse(t),this.currentRange(n))};n.fn.getRangeText=i?r:function(n){if(n=n||this.currentRange(),n)return n.toString()};n.fn.getRangeElem=i?r:function(n){n=n||this.currentRange();var t=n.commonAncestorContainer;return t.nodeType===1?t:t.parentNode};n.fn.isRangeEmpty=i?r:function(n){return(n=n||this.currentRange(),n&&n.startContainer&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset)?!0:!1};n.fn.saveSelection=i?r:function(n){var u=this,i,r,f=u.txt.$txt.get(0);n?i=n.commonAncestorContainer:(r=document.getSelection(),r.getRangeAt&&r.rangeCount&&(n=document.getSelection().getRangeAt(0),i=n.commonAncestorContainer));i&&(t.contains(f,i)||f===i)&&u.currentRange(n)};n.fn.restoreSelection=i?r:function(t){var i;if(t=t||this.currentRange(),t)try{i=document.getSelection();i.removeAllRanges();i.addRange(t)}catch(r){n.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}};n.fn.restoreSelectionByElem=i?r:function(n,t){n&&(t=t||"end",this.setRangeByElem(n),t==="start"&&this.collapseRange(this.currentRange(),"start"),t==="end"&&this.collapseRange(this.currentRange(),"end"),this.restoreSelection())};n.fn.initSelection=i?r:function(){var n=this,i,t;n.currentRange()||(i=n.txt.$txt,t=i.children().first(),t.length&&n.restoreSelectionByElem(t.get(0)))};n.fn.setRangeByElem=i?r:function(n){var f=this,e=f.txt.$txt.get(0),r,i,u;if(n&&t.contains(e,n)){for(r=n.firstChild;r;){if(r.nodeType===3)break;r=r.firstChild}for(i=n.lastChild;i;){if(i.nodeType===3)break;i=i.lastChild}u=document.createRange();r&&i?(u.setStart(r,0),u.setEnd(i,i.textContent.length)):(u.setStart(n,0),u.setEnd(n,0));f.saveSelection(u)}}}),t(function(n,t){n.w3cRange||(n.fn.getRangeText=function(n){if(n=n||this.currentRange(),n)return n.text},n.fn.getRangeElem=function(n){if(n=n||this.currentRange(),n){var t=n.parentElement();return t.nodeType===1?t:t.parentNode}},n.fn.isRangeEmpty=function(n){return(n=n||this.currentRange(),n&&n.text)?!1:!0},n.fn.saveSelection=function(n){var r=this,i,u=r.txt.$txt.get(0);n?i=n.parentElement():(n=document.selection.createRange(),i=typeof n.parentElement=="undefined"?null:n.parentElement());i&&(t.contains(u,i)||u===i)&&r.currentRange(n)},n.fn.restoreSelection=function(n){var i=this,t;if(n=n||i.currentRange(),n){t=document.selection.createRange();try{t.setEndPoint("EndToEnd",n)}catch(r){}if(n.text.length===0)try{t.collapse(!1)}catch(r){}else t.setEndPoint("StartToStart",n);t.select()}})}),t(function(n,t){n.fn.commandHooks=function(){var n=this,i={};i.insertHtml=function(i){var u=t(i),f=n.getRangeElem(),r;(r=n.getLegalTags(f),r)&&t(r).after(u)};n.commandHooks=i}}),t(function(n){n.fn.command=function(n,t,i,r){function e(){t&&(f.queryCommandSupported(t)?document.execCommand(t,!1,i):(u=f.commandHooks,t in u&&u[t](i)))}var f=this,u;this.customCommand(n,e,r)};n.fn.commandForElem=function(n,t,i,r,u){var e,o,f;typeof n=="string"?e=n:(e=n.selector,o=n.check);f=this.getRangeElem();f=this.getSelfOrParentByName(f,e,o);f&&this.setRangeByElem(f);this.command(t,i,r,u)};n.fn.customCommand=function(n,t,i){function f(){r.hideDropPanelAndModal()}var r=this,u=r.currentRange();if(!u){n&&n.preventDefault();return}r.undoRecord();this.restoreSelection(u);t.call(r);this.saveSelection();this.restoreSelection();i&&typeof i=="function"&&i.call(r);r.txt.insertEmptyP();r.txt.wrapImgAndText();r.updateValue();r.updateMenuStyle();setTimeout(f,200);n&&n.preventDefault()};n.fn.queryCommandValue=function(n){var t="";try{t=document.queryCommandValue(n)}catch(i){}return t};n.fn.queryCommandState=function(n){var t=!1;try{t=document.queryCommandState(n)}catch(i){}return t};n.fn.queryCommandSupported=function(n){var t=!1;try{t=document.queryCommandSupported(n)}catch(i){}return t}}),t(function(n,t){function r(n){var r=this,u=t(n),i=!1;return u.each(function(){if(this===r)return i=!0,!1}),i}var i;n.fn.getLegalTags=function(t){var i=this.config.legalTags;if(!i){n.error("配置项中缺少 legalTags 的配置");return}return this.getSelfOrParentByName(t,i)};n.fn.getSelfOrParentByName=function(n,u,f){if(n&&u){i||(i=n.webkitMatchesSelector||n.mozMatchesSelector||n.oMatchesSelector||n.matchesSelector);i||(i=r);for(var e=this.txt.$txt.get(0);n&&e!==n&&t.contains(e,n);){if(i.call(n,u)&&(!f||f(n)))return n;n=n.parentNode}return}}}),t(function(n){function r(n,t,i){var r=t.val,u=n.txt.$txt.html();if(r!=null){if(r===u){if(i==="redo"){n.redo();return}if(i==="undo"){n.undo();return}return}n.txt.$txt.html(r);n.updateValue();n.onchange&&typeof n.onchange=="function"&&n.onchange.call(n)}}var i=[],t=[],u=20;n.fn.undoRecord=function(){var n=this,f=n.txt.$txt,r=f.html(),e=t.length?t[0]:"";r!==e.val&&(i.length&&(i=[]),t.unshift({range:n.currentRange(),val:r}),t.length>u&&t.pop())};n.fn.undo=function(){if(t.length){var n=t.shift();i.unshift(n);r(this,n,"undo")}};n.fn.redo=function(){if(i.length){var n=i.shift();t.unshift(n);r(this,n,"redo")}}}),t(function(n,t){n.fn.create=function(){var i=this,r;n.$body&&n.$body.length!==0||(n.$body=t("body"),n.$document=t(document),n.$window=t(window));i.addMenus();i.renderMenus();i.renderMenuContainer();i.renderTxt();i.renderEditorContainer();i.eventMenus();i.eventMenuContainer();i.eventTxt();i.readyHeadler();i.initSelection();i.$txt=i.txt.$txt;r=n._plugins;r&&r.length&&t.each(r,function(n,t){t.call(i)})};n.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable");this.disableMenusExcept();this._disabled=!0};n.fn.enable=function(){this._disabled=!1;this.txt.$txt.attr("contenteditable","true");this.enableMenusExcept()};n.fn.destroy=function(){var n=this,t=n.$valueContainer,i=n.$editorContainer,r=n.valueNodeName;r==="div"?(t.removeAttr("contenteditable"),i.after(t),i.hide()):(t.show(),i.hide())};n.fn.undestroy=function(){var n=this,t=n.$valueContainer,i=n.$editorContainer,r=n.menuContainer.$menuContainer,u=n.valueNodeName;u==="div"?(t.attr("contenteditable","true"),r.after(t),i.show()):(t.hide(),i.show())};n.fn.clear=function(){var n=this,t=n.txt.$txt;t.html("<p><br><\/p>");n.restoreSelectionByElem(t.find("p").get(0))}}),t(function(n){var t=function(n){this.editor=n;this.init()};t.fn=t.prototype;n.MenuContainer=t}),t(function(n,t){var i=n.MenuContainer;i.fn.init=function(){var n=this,i=t('<div class="JEditor-menu-container clearfix"><\/div>');n.$menuContainer=i;n.changeShadow()};i.fn.changeShadow=function(){var n=this.$menuContainer,i=this.editor,t=i.txt.$txt;t.on("scroll",function(){t.scrollTop()>10?n.addClass("JEditor-menu-shadow"):n.removeClass("JEditor-menu-shadow")})}}),t(function(n,t){var i=n.MenuContainer;i.fn.render=function(){var n=this.$menuContainer,t=this.editor.$editorContainer;t.append(n)};i.fn.height=function(){var n=this.$menuContainer;return n.height()};i.fn.appendMenu=function(n,t){return this._addGroup(n),this._addOneMenu(t)};i.fn._addGroup=function(n){var r=this.$menuContainer,i;this.$currentGroup&&this.currentGroupIdx===n||(i=t('<div class="menu-group clearfix"><\/div>'),r.append(i),this.$currentGroup=i,this.currentGroupIdx=n)};i.fn._addOneMenu=function(n){var u=n.$domNormal,r=n.$domSelected,f=this.$currentGroup,i=t('<div class="menu-item clearfix"><\/div>');return r.hide(),i.append(u).append(r),n.$dot&&i.append(n.$dot),f.append(i),i}}),t(function(n){var t=function(n){this.editor=n.editor;this.id=n.id;this.title=n.title;this.$domNormal=n.$domNormal;this.$domSelected=n.$domSelected||n.$domNormal;this.$dot=n.$dot;this.commandName=n.commandName;this.commandValue=n.commandValue;this.commandNameSelected=n.commandNameSelected||n.commandName;this.commandValueSelected=n.commandValueSelected||n.commandValue};t.fn=t.prototype;n.Menu=t}),t(function(n,t){var i=n.Menu;i.fn.initUI=function(){var f=this.editor,r=f.UI.menus,u=this.id,i=r[u];this.$domNormal&&this.$domSelected||(i==null&&(n.warn('editor.UI配置中，没有菜单 "'+u+'" 的UI配置，只能取默认值'),i=r["default"]),this.$domNormal=t(i.normal),this.$domSelected=/^\./.test(i.selected)?this.$domNormal.clone().addClass(i.selected.slice(1)):t(i.selected))}}),t(function(n,t){var i=n.Menu;i.fn.render=function(n){this.initUI();var i=this.editor,r=i.menuContainer,u=r.appendMenu(n,this),t=this.onRender;this._renderTip(u);t&&typeof t=="function"&&t.call(this)};i.fn._renderTip=function(i){function c(){r.show()}function s(){r.hide()}var u=this,h=u.editor,o=u.title,r=t('<div class="menu-tip"><\/div>'),f,e;u.tipWidth||(f=t('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+o+"<\/p>"),n.$body.append(f),h.ready(function(){var e=this,n=f.outerWidth()+5,t=r.outerWidth(),i=parseFloat(r.css("margin-left"),10);f.remove();f=null;r.css({width:n,"margin-left":i+(t-n)/2});u.tipWidth=n}));r.append(o);i.append(r);i.find("a").on("mouseenter",function(){u.active()||u.disabled()||(e=setTimeout(c,200))}).on("mouseleave",function(){e&&clearTimeout(e);s()}).on("click",s)};i.fn.bindEvent=function(){var t=this,u=t.$domNormal,f=t.$domSelected,e=t.$dot,i=t.clickEvent,r;i||(i=function(i){var r=t.dropPanel||t.dropList||t.modal,e,u,f,o;if(r&&r.show){r.isShowing?r.hide():r.show();return}e=t.editor;o=t.selected;o?(u=t.commandNameSelected,f=t.commandValueSelected):(u=t.commandName,f=t.commandValue);u?e.command(i,u,f):(n.warn('菜单 "'+t.id+'" 未定义click事件'),i.preventDefault())});r=t.clickEventSelected||i;u.click(function(n){t.disabled()||(i.call(t,n),t.updateSelected());n.preventDefault()});f.click(function(n){t.disabled()||(r.call(t,n),t.updateSelected());n.preventDefault()})};i.fn.updateSelected=function(){var n=this,r=n.editor,i=n.updateSelectedEvent,t;i||(i=function(){var n=this,t=n.editor,i=n.commandName,r=n.commandValue;if(r){if(t.queryCommandValue(i).toLowerCase()===r.toLowerCase())return!0}else if(t.queryCommandState(i))return!0;return!1});t=i.call(n);t=!!t;n.changeSelectedState(t)};i.fn.changeSelectedState=function(n){var t=this,i=t.selected;if(n!=null&&typeof n=="boolean"){if(i===n)return;t.selected=n;n?(t.$domNormal.hide(),t.$domSelected.show()):(t.$domNormal.show(),t.$domSelected.hide())}};i.fn.active=function(n){if(n==null)return this._activeState;this._activeState=n};i.fn.activeStyle=function(n){var r=this.selected,t=this.$domNormal,i=this.$domSelected;n?(t.addClass("active"),i.addClass("active")):(t.removeClass("active"),i.removeClass("active"));this.active(n)};i.fn.disabled=function(n){if(n==null)return!!this._disabled;if(this._disabled!==n){var t=this.$domNormal,i=this.$domSelected;n?(t.addClass("disable"),i.addClass("disable")):(t.removeClass("disable"),i.removeClass("disable"));this._disabled=n}}}),t(function(n){var t=function(n,t,i){this.editor=n;this.menu=t;this.data=i.data;this.tpl=i.tpl;this.selectorForELemCommand=i.selectorForELemCommand;this.beforeEvent=i.beforeEvent;this.afterEvent=i.afterEvent;this.init()};t.fn=t.prototype;n.DropList=t}),t(function(n,t){var i=n.DropList;i.fn.init=function(){var n=this;n.initDOM();n.bindEvent();n.initHideEvent()};i.fn.initDOM=function(){var n=this,f=n.data,e=n.tpl||"<span>{#title}<\/span>",r=t('<div class="JEditor-drop-list clearfix"><\/div>'),u,i;t.each(f,function(n,f){u=e.replace(/{#commandValue}/ig,n).replace(/{#title}/ig,f);i=t('<a href="#" commandValue="'+n+'"><\/a>');i.append(u);r.append(i)});n.$list=r};i.fn.bindEvent=function(){var n=this,i=n.editor,f=n.menu,e=f.commandName,o=n.selectorForELemCommand,s=n.$list,r=n.beforeEvent,u=n.afterEvent;s.on("click","a[commandValue]",function(n){r&&typeof r=="function"&&r.call(n);var s=t(n.currentTarget).attr("commandValue");f.selected&&i.isRangeEmpty()&&o?i.commandForElem(o,n,e,s):i.command(n,e,s);u&&typeof u=="function"&&u.call(n)})};i.fn.initHideEvent=function(){var i=this,r=i.$list.get(0);n.$body.on("click",function(n){if(i.isShowing){var u=n.target,f=i.menu,e;(e=f.selected?f.$domSelected.get(0):f.$domNormal.get(0),e===u||t.contains(e,u))||r===u||t.contains(r,u)||i.hide()}});n.$window.scroll(function(){i.hide()});n.$window.on("resize",function(){i.hide()})}}),t(function(n){var t=n.DropList;t.fn._render=function(){var n=this,t=n.editor,i=n.$list;t.$editorContainer.append(i);n.rendered=!0};t.fn._position=function(){var i=this,n=i.$list,r=i.editor,u=i.menu,o=r.menuContainer.$menuContainer,f=u.selected?u.$domSelected:u.$domNormal,s=f.offsetParent().position(),a=s.top,v=s.left,y=f.offsetParent().height(),h=f.offsetParent().width(),p=n.outerWidth(),w=r.txt.$txt.outerWidth(),t=a+y,c=v+h/2,e=0-h/2,l=c+p-w;l>-10&&(e=e-l-10);n.css({top:t,left:c,"margin-left":e});r._isMenufixed&&(t=t+(o.offset().top+o.outerHeight()-n.offset().top),n.css({top:t}))};t.fn.show=function(){var n=this,i=n.menu,t;(n.rendered||n._render(),n.isShowing)||(t=n.$list,t.show(),n._position(),n.isShowing=!0,i.activeStyle(!0))};t.fn.hide=function(){var n=this,i=n.menu,t;n.isShowing&&(t=n.$list,t.hide(),n.isShowing=!1,i.activeStyle(!1))}}),t(function(n){var t=function(n,t,i){this.editor=n;this.menu=t;this.$content=i.$content;this.width=i.width||200;this.height=i.height;this.onRender=i.onRender;this.init()};t.fn=t.prototype;n.DropPanel=t}),t(function(n,t){var i=n.DropPanel;i.fn.init=function(){var n=this;n.initDOM();n.initHideEvent()};i.fn.initDOM=function(){var n=this,f=n.$content,e=n.width,r=n.height,i=t('<div class="JEditor-drop-panel clearfix"><\/div>'),u=t('<div class="tip-triangle"><\/div>');i.css({width:e,height:r?r:"auto"});i.append(u);i.append(f);n.$panel=i;n.$triangle=u};i.fn.initHideEvent=function(){var i=this,r=i.$panel.get(0);n.$body.on("click",function(n){if(i.isShowing){var u=n.target,f=i.menu,e;(e=f.selected?f.$domSelected.get(0):f.$domNormal.get(0),e===u||t.contains(e,u))||r===u||t.contains(r,u)||i.hide()}});n.$window.scroll(function(){i.hide()});n.$window.on("resize",function(){i.hide()})}}),t(function(n,t){var i=n.DropPanel;i.fn._render=function(){var n=this,t=n.onRender,i=n.editor,r=n.$panel;i.$editorContainer.append(r);t&&t.call(n);n.rendered=!0};i.fn._position=function(){var t=this,i=t.$panel,a=t.$triangle,f=t.editor,h=f.menuContainer.$menuContainer,e=t.menu,o=e.selected?e.$domSelected:e.$domNormal,c=o.offsetParent().position(),v=c.top,y=c.left,p=o.offsetParent().height(),w=o.offsetParent().width(),l=i.outerWidth(),b=f.txt.$txt.outerWidth(),r=v+p,u=y+w/2,n=0-l/2,k=n,s;0-n>u-10&&(n=10-u);s=u+l+n-b;s>-10&&(n=n-s-10);i.css({top:r,left:u,"margin-left":n});f._isMenufixed&&(r=r+(h.offset().top+h.outerHeight()-i.offset().top),i.css({top:r}));a.css({"margin-left":k-n-5})};i.fn.focusFirstInput=function(){var n=this,i=n.$panel;i.find("input[type=text],textarea").each(function(){var n=t(this);if(n.attr("disabled")==null)return n.focus(),!1})};i.fn.show=function(){var t=this,r=t.menu,i;(t.rendered||t._render(),t.isShowing)||(i=t.$panel,i.show(),t._position(),t.isShowing=!0,r.activeStyle(!0),n.w3cRange?t.focusFirstInput():n.placeholderForIE8(i))};i.fn.hide=function(){var n=this,i=n.menu,t;n.isShowing&&(t=n.$panel,t.hide(),n.isShowing=!1,i.activeStyle(!1))}}),t(function(n){var t=function(n,t,i){this.editor=n;this.menu=t;this.$content=i.$content;this.init()};t.fn=t.prototype;n.Modal=t}),t(function(n,t){var i=n.Modal;i.fn.init=function(){var n=this;n.initDom();n.initHideEvent()};i.fn.initDom=function(){var n=this,u=n.$content,i=t('<div class="JEditor-modal"><\/div>'),r=t('<div class="JEditor-modal-close"><i class="jeditor-icon-cancel-circle"><\/i><\/div>');i.append(r);i.append(u);n.$modal=i;n.$close=r};i.fn.initHideEvent=function(){var i=this,u=i.$close,r=i.$modal.get(0);u.click(function(){i.hide()});n.$body.on("click",function(n){if(i.isShowing){var u=n.target,f=i.menu,e;f&&(e=f.selected?f.$domSelected.get(0):f.$domNormal.get(0),e===u||t.contains(e,u))||r===u||t.contains(r,u)||i.hide()}})}}),t(function(n){var t=n.Modal;t.fn._render=function(){var t=this,r=t.editor,i=t.$modal;i.css("z-index",r.config.zindex+10+"");n.$body.append(i);t.rendered=!0};t.fn._position=function(){var f=this,t=f.$modal,i=t.offset().top,e=t.outerWidth(),r=t.outerHeight(),o=0-e/2,u=0-r/2,s=n.$window.scrollTop();r/2>i&&(u=0-i);t.css({"margin-left":o+"px","margin-top":u+s+"px"})};t.fn.show=function(){var n=this,t=n.menu,i;(n.rendered||n._render(),n.isShowing)||(n.isShowing=!0,i=n.$modal,i.show(),n._position(),t&&t.activeStyle(!0))};t.fn.hide=function(){var n=this,t=n.menu,i;n.isShowing&&(n.isShowing=!1,i=n.$modal,i.hide(),t&&t.activeStyle(!1))}}),t(function(n){var t=function(n){this.editor=n;this.init()};t.fn=t.prototype;n.Txt=t}),t(function(n,t){var i=n.Txt;i.fn.init=function(){var n=this,r=n.editor,u=r.$valueContainer,f=r.getInitValue(),i;u.get(0).nodeName==="DIV"?(i=u,i.addClass("JEditor-txt"),i.attr("contentEditable","true")):i=t('<div class="JEditor-txt" contentEditable="true">'+f+"<\/div>");r.ready(function(){n.insertEmptyP()});n.$txt=i;n.contentEmptyHandle();n.bindEnterForDiv();n.bindEnterForText();n.bindTabEvent();n.bindPasteFilter();n.bindFormatText();n.bindHtml()};i.fn.contentEmptyHandle=function(){var r=this,u=r.editor,n=r.$txt,i;n.on("keydown",function(i){if(i.keyCode===8){var r=t.trim(n.html().toLowerCase());if(r==="<p><br><\/p>"){i.preventDefault();return}}});n.on("keyup",function(r){if(r.keyCode===8){var f=t.trim(n.html().toLowerCase());f&&f!=="<br>"||(i=t("<p><br/><\/p>"),n.html(""),n.append(i),u.restoreSelectionByElem(i.get(0)))}})};i.fn.bindEnterForDiv=function(){function e(){if(i){var n=t("<p>"+i.html()+"<\/p>");i.after(n);i.remove()}}var o=n.config.legalTags,u=this,r=u.editor,f=u.$txt,i;f.on("keydown keyup",function(n){if(n.keyCode===13){var s=r.getRangeElem(),f=r.getLegalTags(s),u,o;if(!f){if(f=r.getSelfOrParentByName(s,"div"),!f)return;u=t(f);n.type==="keydown"&&(i=u,setTimeout(e,0));n.type==="keyup"&&(o=t("<p>"+u.html()+"<\/p>"),u.after(o),u.remove(),r.restoreSelectionByElem(o.get(0),"start"))}}})};i.fn.bindEnterForText=function(){var t=this,i=t.$txt,n;i.on("keyup",function(i){i.keyCode===13&&(n||(n=function(){t.wrapImgAndText()}),setTimeout(n))})};i.fn.bindTabEvent=function(){var n=this,t=n.editor,i=n.$txt;i.on("keydown",function(n){n.keyCode===9&&t.queryCommandSupported("insertHtml")&&t.command(n,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")})};i.fn.bindPasteFilter=function(){function c(n,t,r){var u=i.config.uploadImgFileName||"JEditorPasteFile";i.xhrUploadImg({event:r,fileUrl:n,uploadKey:t,name:u,success:l})}function l(n,t){var i=f.find("img[data-upload-key="+t+"]"),r;i.length>0&&n&&(r=JSON.parse(n),r.data.fileUrl&&(i.removeAttr("data-upload-key"),i.attr({src:r.data.fileUrl})))}function o(i){if(i&&i.nodeType&&i.nodeName){var f,u=i.nodeName.toLowerCase(),e=i.nodeType;if(e===3||e===1){if(f=t(i),u==="div"){t.each(i.childNodes,function(){o(this)});return}if(h.indexOf(u)>=0)n+=a(i);else if(e===3)n+="<p>"+i.textContent+"<\/p>";else if(u==="br")n+="<br/>";else{if(["meta","style","script","object","form","iframe","hr"].indexOf(u)>=0)return;f=t(r(i));n+=t("<div>").append(f.clone()).html()}}}}function a(n){var i=n.nodeName.toLowerCase(),u,f="",e="";return["blockquote"].indexOf(i)>=0?(u=t(n),"<"+i+">"+u.text()+"<\/"+i+">"):["p","h1","h2","h3","h4","h5"].indexOf(i)>=0?(n=r(n),u=t(n),f=u.html(),f=f.replace(/<.*?>/ig,function(n){return n==="<\/a>"||n.indexOf("<a ")===0||n.indexOf("<img ")===0?n:""}),"<"+i+">"+f+"<\/"+i+">"):["ul","ol"].indexOf(i)>=0?(u=t(n),u.children().each(function(){var i=t(r(this)),n=i.html();n=n.replace(/<.*?>/ig,function(n){return n==="<\/a>"||n.indexOf("<a ")===0||n.indexOf("<img ")===0?n:""});e+="<li>"+n+"<\/li>"}),"<"+i+">"+e+"<\/"+i+">"):(u=t(r(n)),t("<div>").append(u).html())}function r(n){var f=n.attributes||[],u=[],e=["href","target","src","alt","rowspan","colspan"],i;return t.each(f,function(n,t){t&&t.nodeType===2&&u.push(t.nodeName)}),t.each(u,function(t,i){e.indexOf(i)<0&&n.removeAttribute(i)}),i=n.childNodes,i.length&&t.each(i,function(n,t){r(t)}),n}var u=this,i=u.editor,n="",f=u.$txt,s=i.config.legalTags,h=s.split(","),e;f.on("paste",function(r){var l,b,h,a,v;if((e=r,i.config.pasteFilter)&&(l=i.getRangeElem().nodeName,l!=="TD"&&l!=="TH")){n="";var f,y,s=r.clipboardData||r.originalEvent.clipboardData,p=s&&s.items,w=0;if(p.length===2&&(w=1),b=p[w].getAsFile(),s&&s.getData)f=s.getData("text/html"),f?(y=t("<div>"+f+"<\/div>"),o(y.get(0))):(f=s.getData("text/plain"),f&&(f=f.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<\/p><p>"),n="<p>"+f+"<\/p>",n=n.replace(/<p>(https?:\/\/.*?)<\/p>/ig,function(n,t){return'<p><a href="'+t+'" target="_blank">'+t+"<\/p>"})));else if(window.clipboardData&&window.clipboardData.getData){if(n=window.clipboardData.getData("text"),!n)return;n="<p>"+n+"<\/p>";n=n.replace((new RegExp("\n","g"),"<\/p><p>"))}else return;n&&b==null&&(h=[],v=t("<div/>").append(n),t.each(v.find("img"),function(n,i){var r=t(i),u=r.attr("src");a=Math.round(Math.random()*9e4+1e4);h.push({key:a,url:u});r.attr({"data-upload-key":a,src:"http://test.m1world.com/page/common/images/loading.gif"})}),n=v.html(),i.command(r,"insertHtml",n),u.clearEmptyOrNestP(),h.length>0&&h.forEach(function(n){c(n.url,n.key,e)}))}})};i.fn.bindFormatText=function(){var r=this,o=r.editor,u=r.$txt,e=n.config.legalTags,f=e.split(","),s=f.length,i=[];t.each(f,function(n,t){var r=">\\s*<("+t+")>";i.push(new RegExp(r,"ig"))});i.push(new RegExp(">\\s*<(li)>","ig"));i.push(new RegExp(">\\s*<(tr)>","ig"));i.push(new RegExp(">\\s*<(code)>","ig"));u.formatText=function(){var r=t("<div>"),n=u.html();return n=n.replace(/\s*</ig,"<"),t.each(i,function(t,i){i.test(n)&&(n=n.replace(i,function(n,t){return">\n<"+t+">"}))}),r.html(n),r.text()}};i.fn.bindHtml=function(){var i=this,r=i.editor,n=i.$txt,u=r.$valueContainer,f=r.valueNodeName;n.html=function(i){var r;if(f==="div"&&(r=t.fn.html.call(n,i)),i===undefined?(r=t.fn.html.call(n),r=r.replace(/(href|src)\=\"(.*)\"/igm,function(n,t,i){return t+'="'+i.replace("&amp;","&")+'"'})):(r=t.fn.html.call(n,i),u.val(i)),i===undefined)return r;n.change()}}}),t(function(n,t){var i=n.Txt,r="propertychange change click keyup input paste";i.fn.render=function(){var n=this.$txt,t=this.editor.$editorContainer;t.append(n)};i.fn.initHeight=function(){var t=this.editor,u=this.$txt,i=t.$valueContainer.height(),r=t.menuContainer.height(),n=i-r;n=n<50?50:n;u.height(n);t.valueContainerHeight=i;this.initMaxHeight(n,r)};i.fn.initMaxHeight=function(i,r){var u=this.editor,s=u.menuContainer.$menuContainer,f=this.$txt,e=t("<div>"),o;if(window.getComputedStyle&&"max-height"in window.getComputedStyle(f.get(0))){if(o=parseInt(u.$valueContainer.css("max-height")),isNaN(o))return;if(u.menus.fullscreen){n.warn("max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用");return}u.useMaxHeight=!0;e.css({"max-height":o-r+"px","overflow-y":"auto"});f.css({height:"auto","overflow-y":"visible","min-height":i+"px"});e.on("scroll",function(){f.parent().scrollTop()>10?s.addClass("JEditor-menu-shadow"):s.removeClass("JEditor-menu-shadow")});f.wrap(e)}};i.fn.saveSelectionEvent=function(){function f(){i.saveSelection()}function e(){Date.now()-u<100||(u=Date.now(),f())}function o(){t&&clearTimeout(t);t=setTimeout(f,300)}var n=this.$txt,i=this.editor,t,u=Date.now();n.on(r+" focus blur",function(){e();o()});n.on("mousedown",function(){n.on("mouseleave.saveSelection",function(){e();o();i.updateMenuStyle()})}).on("mouseup",function(){n.off("mouseleave.saveSelection")})};i.fn.updateValueEvent=function(){function f(){var r=i.html();t!==r&&(n.onchange&&typeof n.onchange=="function"&&n.onchange.call(n),n.updateValue(),t=r)}var i=this.$txt,n=this.editor,u,t;i.on(r,function(){t==null&&(t=i.html());u&&clearTimeout(u);u=setTimeout(f,100)})};i.fn.updateMenuStyleEvent=function(){var n=this.$txt,t=this.editor;n.on(r,function(){t.updateMenuStyle()})};i.fn.insertEmptyP=function(){var n=this.$txt,i=n.children();if(i.length===0){n.append(t("<p><br><\/p>"));return}t.trim(i.last().html()).toLowerCase()!=="<br>"&&n.append(t("<p><br><\/p>"))};i.fn.wrapImgAndText=function(){var r=this.$txt,u=r.children("img"),e=r[0],f=e.childNodes,o=f.length,i,n;for(u.length&&u.each(function(){t(this).wrap("<p>")}),i=0;i<o;i++)n=f[i],n.nodeType===3&&n.textContent&&t.trim(n.textContent)&&t(n).wrap("<p>")};i.fn.clearEmptyOrNestP=function(){var n=this.$txt,i=n.find("p");i.each(function(){var n=t(this),r=n.children(),u=r.length,i,f=t.trim(n.html());if(!f){n.remove();return}u===1&&(i=r.first(),i.get(0)&&i.get(0).nodeName==="P"&&n.html(i.html()))})};i.fn.scrollTop=function(n){var t=this,r=t.editor,i=t.$txt;return r.useMaxHeight?i.parent().scrollTop(n):i.scrollTop(n)};i.fn.showHeightOnHover=function(){function o(t){n||(e.append(r),n=!0);var a=i.position().top,v=i.outerHeight(),u=t.height(),o=t.position().top,s=parseInt(t.css("margin-top"),10),h=parseInt(t.css("padding-top"),10),c=parseInt(t.css("margin-bottom"),10),l=parseInt(t.css("padding-bottom"),10),y=u+h+s+l+c,p=o+f.height();r.css({height:u+h+s+l+c,top:o+f.height()})}function s(){n&&(r.remove(),n=!1)}var u=this.editor,e=u.$editorContainer,f=u.menuContainer,i=this.$txt,r=t('<i class="height-tip"><i>'),n=!1;i.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(n){o(t(n.currentTarget))}).on("mouseleave",function(){s()})}}),t(function(n,t){Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]===n)return t;return-1},Array.prototype.lastIndexOf=function(n){for(var t=this.length,t=t-1;t>=0;t--)if(this[t]===n)return t;return-1});Date.now||(Date.now=function(){return(new Date).valueOf()});var i=window.console,r=function(){};t.each(["info","log","warn","error"],function(t,u){n[u]=i==null?r:function(t){n.config&&n.config.printLog&&i[u]("JEditor提示: "+t)}});n.random=function(){return Math.random().toString().slice(2)};n.placeholder="placeholder"in document.createElement("input");n.placeholderForIE8=function(i){n.placeholder||i.find("input[placeholder]").each(function(){var n=t(this),i=n.attr("placeholder");if(n.val()===""){n.css("color","#666");n.val(i);n.on("focus.placeholder click.placeholder",function(){n.val("");n.css("color","#333");n.off("focus.placeholder click.placeholder")})}})}}),t(function(n){n.langs={};n.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频",width:"宽",height:"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏",openLink:"打开链接"};n.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video",width:"width",height:"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn",openLink:"open link"}}),t(function(n){n.config={};n.config.zindex=1e4;n.config.printLog=!0;n.config.menuFixed=0;n.config.jsFilter=!0;n.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre";n.config.lang=n.langs["zh-cn"];n.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"];n.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"};n.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS"];n.config.fontsizes={1:"10px",2:"13px",3:"16px",4:"19px",5:"22px",6:"25px",7:"28px"};n.config.emotionsShow="icon";n.config.emotions={"default":{title:"默认",data:"./emotions.data"},weibo:{title:"微博表情",data:[{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",value:"[草泥马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",value:"[神马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif",value:"[给力]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif",value:"[围观]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif",value:"[威武]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif",value:"[熊猫]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif",value:"[兔子]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif",value:"[囧]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif",value:"[互粉]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif",value:"[礼物]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif",value:"[哈哈]"}]}};n.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas";n.config.uploadImgUrl="";n.config.uploadTimeout=12e5;n.config.uploadImageMaxSize=2097152;n.config.uploadVideoMaxSize=209715200;n.config.uploadImgFns={};n.config.uploadVideoFns={};n.config.customUpload=!1;n.config.uploadParams={};n.config.uploadParamsVideo={};n.config.pasteFilter=!0}),t(function(n){n.UI={};n.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-command"><\/i><\/a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-bold"><\/i><\/a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-underline"><\/i><\/a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-italic"><\/i><\/a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-pencil"><\/i><\/a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-brush"><\/i><\/a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-strikethrough"><\/i><\/a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-eraser"><\/i><\/a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-quotes-left"><\/i><\/a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-code"><\/i><\/a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-font2"><\/i><\/a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-text-height"><\/i><\/a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-header"><\/i><\/a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-list-numbered"><\/i><\/a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-list-bullet"><\/i><\/a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-align-left"><\/i><\/a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-align-center"><\/i><\/a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-align-right"><\/i><\/a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-link"><\/i><\/a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-unlink"><\/i><\/a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-table"><\/i><\/a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-happy"><\/i><\/a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-picture"><\/i><\/a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-play"><\/i><\/a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-location"><\/i><\/a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-terminal"><\/i><\/a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-ccw"><\/i><\/a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-cw"><\/i><\/a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="jeditor-icon-enlarge2"><\/i><\/a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="jeditor-icon-shrink2"><\/i><\/a>'}}}),t(function(n,t){n.fn.initDefaultConfig=function(){var i=this;i.config=t.extend({},n.config);i.UI=t.extend({},n.UI)}}),t(function(n,t){n.fn.addEditorContainer=function(){this.$editorContainer=t('<div class="JEditor-container"><\/div>')}}),t(function(n){n.fn.addTxt=function(){var t=this,i=new n.Txt(t);t.txt=i}}),t(function(n){n.fn.addMenuContainer=function(){var t=this;t.menuContainer=new n.MenuContainer(t)}}),t(function(n,t){n.createMenuFns=[];n.createMenu=function(t){n.createMenuFns.push(t)};n.fn.addMenus=function(){function u(n){return r.indexOf(n)>=0?!0:!1}var i=this,r=i.config.menus;t.each(n.createMenuFns,function(n,t){t.call(i,u)})}}),t(function(n){n.createMenu(function(t){var r="bold";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.bold,commandName:"Bold"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("b,strong,h1,h2,h3,h4,h5",n,"Bold"):i.command(n,"Bold")};i.menus[r]=u}})}),t(function(n){n.createMenu(function(t){var r="underline";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.underline,commandName:"Underline"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("u,a",n,"Underline"):i.command(n,"Underline")};i.menus[r]=u}})}),t(function(n){n.createMenu(function(t){var r="italic";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.italic,commandName:"Italic"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("i",n,"Italic"):i.command(n,"Italic")};i.menus[r]=u}})}),t(function(n,t){n.createMenu(function(i){var f="forecolor";if(i(f)){var r=this,o=r.config.lang,s=r.config.colors,u=new n.Menu({editor:r,id:f,title:o.forecolor}),e=t("<div><\/div>");t.each(s,function(n,t){e.append(['<a href="#" class="color-item"','    title="'+t+'" commandValue="'+n+'" ','    style="color: '+n+'" ','><i class="jeditor-icon-pencil"><\/i><\/a>'].join(""))});e.on("click","a[commandValue]",function(n){var f=t(this),i=f.attr("commandValue");u.selected&&r.isRangeEmpty()?r.commandForElem("font[color]",n,"forecolor",i):r.command(n,"forecolor",i)});u.dropPanel=new n.DropPanel(r,u,{$content:e,width:125});u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"font[color]"),n)?!0:!1};r.menus[f]=u}})}),t(function(n,t){n.createMenu(function(i){function o(n){var t;return n&&n.style&&n.style.cssText!=null&&(t=n.style.cssText,t&&t.indexOf("background-color:")>=0)?!0:!1}var e="bgcolor",u,f;if(i(e)){var r=this,s=r.config.lang,h=r.config.colors;u=new n.Menu({editor:r,id:e,title:s.bgcolor});f=t("<div><\/div>");t.each(h,function(n,t){f.append(['<a href="#" class="color-item"','    title="'+t+'" commandValue="'+n+'" ','    style="color: '+n+'" ','><i class="jeditor-icon-brush"><\/i><\/a>'].join(""))});f.on("click","a[commandValue]",function(n){var f=t(this),i=f.attr("commandValue");u.selected&&r.isRangeEmpty()?r.commandForElem({selector:"span,font",check:o},n,"BackColor",i):r.command(n,"BackColor",i)});u.dropPanel=new n.DropPanel(r,u,{$content:f,width:125});u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"span,font",o),n)?!0:!1};r.menus[e]=u}})}),t(function(n){n.createMenu(function(t){var r="strikethrough";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.strikethrough,commandName:"StrikeThrough"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("strike",n,"StrikeThrough"):i.command(n,"StrikeThrough")};i.menus[r]=u}})}),t(function(n,t){n.createMenu(function(i){var u="eraser";if(i(u)){var r=this,e=r.config.lang,f=new n.Menu({editor:r,id:u,title:e.eraser,commandName:"RemoveFormat"});f.clickEvent=function(n){function f(){var n=this,r,u,f,e,o,s,h;r=n.getRangeElem();e=n.getSelfOrParentByName(r,"blockquote");e&&(o=t(e),i=t("<p>"+o.text()+"<\/p>"),o.after(i).remove());u=n.getSelfOrParentByName(r,"p,h1,h2,h3,h4,h5");u&&(f=t(u),i=t("<p>"+f.text()+"<\/p>"),f.after(i).remove());s=n.getSelfOrParentByName(r,"ul,ol");s&&(h=t(s),i=t("<p>"+h.text()+"<\/p>"),h.after(i).remove())}function e(){var n=this;i&&n.restoreSelectionByElem(i.get(0))}var u=r.isRangeEmpty(),i;if(!u){r.command(n,"RemoveFormat");return}r.customCommand(n,f,e)};r.menus[u]=f}})}),t(function(n,t){n.createMenu(function(i){function s(){var t=r.$codeTextarea,i=u.txt.$txt,n=t.val();u.config.jsFilter&&(n=n.replace(/<script[\s\S]*?<\/script>/ig,""));i.html(n)}var f="source";if(i(f)){var u=this,o=u.config.lang,e,r=new n.Menu({editor:u,id:f,title:o.source});r.isShowCode=!1;r.clickEvent=function(){var u=this,f=u.editor,n=f.txt.$txt,s=n.outerHeight(),o=n.height(),i;u.$codeTextarea||(u.$codeTextarea=t('<textarea class="code-textarea"><\/textarea>'));i=u.$codeTextarea;i.css({height:o,"margin-top":s-o});i.val(n.html());n.after(i).hide();i.show();r.isShowCode=!0;this.updateSelected();f.disableMenusExcept("source");e=n.html()};r.clickEventSelected=function(){var i=this,n=i.editor,t=n.txt.$txt,u=i.$codeTextarea;u&&(s(),u.after(t).hide(),t.show(),r.isShowCode=!1,this.updateSelected(),n.enableMenusExcept("source"),t.html()!==e&&n.onchange&&typeof n.onchange=="function"&&n.onchange.call(n))};r.updateSelectedEvent=function(){return this.isShowCode};u.menus[f]=r}})}),t(function(n,t){n.createMenu(function(i){var f="quote";if(i(f)){var r=this,e=r.config.lang,u=new n.Menu({editor:r,id:f,title:e.quote,commandName:"formatBlock",commandValue:"blockquote"});u.clickEvent=function(n){function o(){u=t("<p>"+f.text()+"<\/p>");f.after(u).remove();u.wrap("<blockquote>")}function s(){var n=this;u&&n.restoreSelectionByElem(u.get(0))}var i=r.getRangeElem(),f,e,u;if(!i){n.preventDefault();return}if(e=r.getSelfOrParentByName(i,"blockquote"),e){n.preventDefault();return}if(i=r.getLegalTags(i),f=t(i),f.text()){if(!i){r.command(n,"formatBlock","blockquote");return}r.customCommand(n,o,s)}};u.clickEventSelected=function(n){function e(){var n,r;if(n=t(i),r=n.children(),r.length){r.each(function(){var i=t(this);i.get(0).nodeName==="P"?n.after(i):n.after("<p>"+i.text()+"<\/p>");u=i});n.remove();return}}function o(){var n=this;u&&n.restoreSelectionByElem(u.get(0))}var f,i,u;if(f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"blockquote"),!i){n.preventDefault();return}r.customCommand(n,e,o)};u.updateSelectedEvent=function(){var i=this,t=i.editor,n;return(n=t.getRangeElem(),n=t.getSelfOrParentByName(n,"blockquote"),n)?!0:!1};r.menus[f]=u;r.ready(function(){var n=this,r=n.txt.$txt,i=!1;r.on("keydown",function(r){var u,e,f;if(r.keyCode!==13){i=!1;return}if(u=n.getRangeElem(),u=n.getSelfOrParentByName(u,"blockquote"),!u){i=!1;return}if(!i){i=!0;return}e=n.getRangeElem();f=t(e);f.length&&f.parent().after(f);n.restoreSelectionByElem(e,"start");i=!1;r.preventDefault()})});r.ready(function(){function u(){i&&i.remove()}function f(){if(i){var t=i.prev();t.length?n.restoreSelectionByElem(t.get(0)):n.initSelection()}}var n=this,r=n.txt.$txt,i;r.on("keydown",function(r){var e,o;r.keyCode===8&&(e=n.getRangeElem(),e=n.getSelfOrParentByName(e,"blockquote"),e)&&((i=t(e),o=i.text(),o)||n.customCommand(r,u,f))})})}})}),t(function(n,t){n.createMenu(function(i){var f="fontfamily",o;if(i(f)){var r=this,s=r.config.lang,h=r.config.familys,u=new n.Menu({editor:r,id:f,title:s.fontfamily,commandName:"fontName"}),e={};t.each(h,function(n,t){e[t]=t});o='<span style="font-family:{#commandValue};">{#title}<\/span>';u.dropList=new n.DropList(r,u,{data:e,tpl:o,selectorForELemCommand:"font[face]"});u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"font[face]"),n)?!0:!1};r.menus[f]=u}})}),t(function(n){n.createMenu(function(t){var u="fontsize";if(t(u)){var i=this,f=i.config.lang,e=i.config.fontsizes,r=new n.Menu({editor:i,id:u,title:f.fontsize,commandName:"fontSize"}),o=e;r.dropList=new n.DropList(i,r,{data:o,tpl:'<span style="font-size:{#title};">{#title}<\/span>',selectorForELemCommand:"font[size]"});r.updateSelectedEvent=function(){var n=i.getRangeElem();return(n=i.getSelfOrParentByName(n,"font[size]"),n)?!0:!1};i.menus[u]=r}})}),t(function(n){n.createMenu(function(t){function s(n){i.queryCommandState("InsertOrderedList")?(f=!0,i.command(n,"InsertOrderedList")):f=!1}function h(n){f&&i.command(n,"InsertOrderedList")}var u="head",e;if(t(u)){var i=this,o=i.config.lang,r=new n.Menu({editor:i,id:u,title:o.head,commandName:"formatBlock"}),f;e="{#commandValue}{#title}";r.dropList=new n.DropList(i,r,{data:{"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"},tpl:e,beforeEvent:s,afterEvent:h});r.updateSelectedEvent=function(){var n=i.getRangeElem();return(n=i.getSelfOrParentByName(n,"h1,h2,h3,h4,h5"),n)?!0:!1};i.menus[u]=r}})}),t(function(n){n.createMenu(function(t){var i="unorderlist";if(t(i)){var r=this,u=r.config.lang,f=new n.Menu({editor:r,id:i,title:u.unorderlist,commandName:"InsertUnorderedList"});r.menus[i]=f}})}),t(function(n){n.createMenu(function(t){var i="orderlist";if(t(i)){var r=this,u=r.config.lang,f=new n.Menu({editor:r,id:i,title:u.orderlist,commandName:"InsertOrderedList"});r.menus[i]=f}})}),t(function(n,t){n.createMenu(function(i){var u="alignleft";if(i(u)){var r=this,e=r.config.lang,f=new n.Menu({editor:r,id:u,title:e.alignleft,commandName:"JustifyLeft"});f.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"p,h1,h2,h3,h4,h5,li",function(n){var i;return n&&n.style&&n.style.cssText!=null&&(i=n.style.cssText,i&&/text-align:\s*left;/.test(i))?!0:t(n).attr("align")==="left"?!0:!1}),n)?!0:!1};r.menus[u]=f}})}),t(function(n,t){n.createMenu(function(i){var u="aligncenter";if(i(u)){var r=this,e=r.config.lang,f=new n.Menu({editor:r,id:u,title:e.aligncenter,commandName:"JustifyCenter"});f.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"p,h1,h2,h3,h4,h5,li",function(n){var i;return n&&n.style&&n.style.cssText!=null&&(i=n.style.cssText,i&&/text-align:\s*center;/.test(i))?!0:t(n).attr("align")==="center"?!0:!1}),n)?!0:!1};r.menus[u]=f}})}),t(function(n,t){n.createMenu(function(i){var u="alignright";if(i(u)){var r=this,e=r.config.lang,f=new n.Menu({editor:r,id:u,title:e.alignright,commandName:"JustifyRight"});f.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"p,h1,h2,h3,h4,h5,li",function(n){var i;return n&&n.style&&n.style.cssText!=null&&(i=n.style.cssText,i&&/text-align:\s*right;/.test(i))?!0:t(n).attr("align")==="right"?!0:!1}),n)?!0:!1};r.menus[u]=f}})}),t(function(n,t){n.createMenu(function(i){var h="link";if(i(h)){var r=this,e=r.config.lang,u=new n.Menu({editor:r,id:h,title:e.link}),c=t("<div><\/div>"),o=t('<div style="margin:20px 10px;" class="clearfix"><\/div>'),l=o.clone(),a=o.clone().css("margin","0 10px"),f=t('<input type="text" class="block" placeholder="'+e.text+'"/>'),s=t('<input type="text" class="block" placeholder="'+e.link+'"/>'),v=t('<button class="right">'+e.submit+"<\/button>"),y=t('<button class="right gray">'+e.cancel+"<\/button>");o.append(f);l.append(s);a.append(v).append(y);c.append(o).append(l).append(a);u.dropPanel=new n.DropPanel(r,u,{$content:c,width:300});u.clickEvent=function(){var o=this,u=o.dropPanel,i,n,t,e;if(u.isShowing){u.hide();return}f.val("");s.val("");i="";n=r.getRangeElem();n=r.getSelfOrParentByName(n,"a");n&&(i=n.href||"");t="";e=r.isRangeEmpty();e?n&&(t=n.textContent||n.innerHTML):t=r.getRangeText()||"";i&&s.val(i);t&&f.val(t);e?f.removeAttr("disabled"):f.attr("disabled",!0);u.show()};u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"a"),n)?!0:!1};y.click(function(n){n.preventDefault();u.dropPanel.hide()});v.click(function(i){i.preventDefault();var k=r.getRangeElem(),h=r.getSelfOrParentByName(k,"a"),d=r.isRangeEmpty(),c,l,y,p,w=r.txt.$txt,a,b,v="link"+n.random(),e=t.trim(s.val()),o=t.trim(f.val());if(!e){u.dropPanel.focusFirstInput();return}o||(o=e);d?h?(c=t(h),y=function(){c.attr("href",e);c.text(o)},p=function(){var n=this;n.restoreSelectionByElem(h)},r.customCommand(i,y,p)):(l='<a href="'+e+'" target="_blank">'+o+"<\/a>",n.userAgent.indexOf("Firefox")>0&&(l+="<span>&nbsp;<\/span>"),r.command(i,"insertHtml",l)):(a=w.find("a"),a.attr(v,"1"),r.command(i,"createLink",e),b=w.find("a").not("["+v+"]"),b.attr("target","_blank"),a.removeAttr(v))});r.menus[h]=u}})}),t(function(n,t){n.createMenu(function(i){var u="unlink";if(i(u)){var r=this,e=r.config.lang,f=new n.Menu({editor:r,id:u,title:e.unlink,commandName:"unLink"});f.clickEvent=function(n){function s(){u.after(f).remove()}function h(){r.restoreSelectionByElem(f.get(0))}var o=r.isRangeEmpty(),e,i,u,f;if(!o){r.command(n,"unLink");return}if(e=r.getRangeElem(),i=r.getSelfOrParentByName(e,"a"),!i){n.preventDefault();return}u=t(i);f=t("<span>"+u.text()+"<\/span>");r.customCommand(n,s,h)};r.menus[u]=f}})}),t(function(n,t){n.createMenu(function(i){var o="table";if(i(o)){for(var u=this,v=u.config.lang,s=new n.Menu({editor:u,id:o,title:v.table}),h=t('<div style="font-size: 14px; color: #666; text-align:right;"><\/div>'),r=t('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">'),c=t("<span>0<\/span>"),y=t("<span> 行 <\/span>"),l=t("<span>0<\/span>"),p=t("<span> 列<\/span>"),a,e,f=0;f<15;f++){for(a=t('<tr index="'+(f+1)+'">'),e=0;e<20;e++)a.append(t('<td index="'+(e+1)+'">'));r.append(a)}h.append(r);h.append(c).append(y).append(l).append(p);r.on("mouseenter","td",function(n){var i=t(n.currentTarget),u=i.attr("index"),e=i.parent(),f=e.attr("index");c.text(f);l.text(u);r.find("tr").each(function(){var n=t(this),i=n.attr("index");parseInt(i,10)<=parseInt(f,10)?n.find("td").each(function(){var n=t(this),i=n.attr("index");parseInt(i,10)<=parseInt(u,10)?n.addClass("active"):n.removeClass("active")}):n.find("td").removeClass("active")})}).on("mouseleave",function(){r.find("td").removeClass("active");c.text(0);l.text(0)});r.on("click","td",function(n){for(var e=t(n.currentTarget),o=e.attr("index"),s=e.parent(),h=s.attr("index"),c=parseInt(h,10),l=parseInt(o,10),f,i="<table>",r=0;r<c;r++){for(i+="<tr>",f=0;f<l;f++)i+="<td><span>&nbsp;<\/span><\/td>";i+="<\/tr>"}i+="<\/table>";u.command(n,"insertHtml",i)});s.dropPanel=new n.DropPanel(u,s,{$content:h,width:262});u.menus[o]=s}})}),t(function(n,t){n.createMenu(function(i){function h(n,i){t.each(n,function(n,u){var f=u.icon||u.url,s=u.value||u.title,h=v==="icon"?f:s,e=t('<a href="#" commandValue="'+h+'"><\/a>'),o=t("<img>");o.attr("_src",f);e.append(o);i.append(e);r.emotionUrls.push(f)})}var o="emotion",f;if(i(o)){var r=this,s=r.config,l=s.lang,a=s.emotions,v=s.emotionsShow;r.emotionUrls=[];f=new n.Menu({editor:r,id:o,title:l.emotion});var c=t('<div class="panel-tab"><\/div>'),e=t('<div class="tab-container"><\/div>'),u=t('<div class="content-container emotion-content-container"><\/div>');t.each(a,function(i,r){var c=r.title,f=r.data,s,o;if(n.log("正在处理 "+c+" 表情的数据..."),s=t('<a href="#">'+c+" <\/a>"),e.append(s),o=t('<div class="content"><\/div>'),u.append(o),s.click(function(n){e.children().removeClass("selected");u.children().removeClass("selected");o.addClass("selected");s.addClass("selected");n.preventDefault()}),typeof f=="string")n.log("将通过 "+f+" 地址ajax下载表情包"),t.get(f,function(i){i=t.parseJSON(i);n.log("下载完毕，得到 "+i.length+" 个表情");h(i,o)});else if(Object.prototype.toString.call(f).toLowerCase().indexOf("array")>0)h(f,o);else{n.error("data 数据格式错误，请修改为正确格式，参考文档："+n.docsite);return}});c.append(e).append(u);e.children().first().addClass("selected");u.children().first().addClass("selected");u.on("click","a[commandValue]",function(i){var e=t(i.currentTarget),f=e.attr("commandValue"),u=document.createElement("img");u.onload=function(){r.command(i,"InsertImage",f);u=null};u.onerror=function(){n.log("如果此处有浏览器js报错，请忽略。这只是编辑器试图通过表情 value 下载图片没有成功，对功能无任何影响");r.command(i,"insertHtml","<span>"+f+"<\/span>");u=null};u.src=f;i.preventDefault()});f.dropPanel=new n.DropPanel(r,f,{$content:c,width:350});f.clickEvent=function(){var i=this,r=i.dropPanel;if(r.isShowing){r.hide();return}(r.show(),i.imgLoaded)||(u.find("img").each(function(){var i=t(this),r=i.attr("_src");i.on("error",function(){n.error("加载不出表情图片 "+r)});i.attr("src",r);i.removeAttr("_src")}),i.imgLoaded=!0)};r.menus[o]=f}})}),t(function(n,t){function i(n,i,r){var h=n.config.lang,c=t('<div class="network-container"><\/div>'),u=t('<input type="text" class="block" placeholder="http://"/>'),e,f,o,s;c.append(u);e=t('<span><i class="jeditor-icon-file-image"><\/i> 图片预览<\/span>');f=t('<div class="content-preview"><\/div>');f.append(e);o=t('<button class="right">'+h.submit+"<\/button>");s=t('<button class="right gray">'+h.cancel+"<\/button>");r.append(c).append(f).append(o).append(s);u.bind("input propertychange",function(){var n=t.trim(t(this).val()),i='<img src="'+n+'" style="max-width:100%; "/>';f.empty().append(i)});s.click(function(n){n.preventDefault();i.dropPanel.hide()});o.click(function(i){function s(){u.val("");f.empty().append(e)}var r,o;if(i.preventDefault(),r=t.trim(u.val()),!r){u.focus();return}o=n.config.uploadImgFileName||"JEditorPasteFile";n.xhrUploadImg({event:i,fileUrl:r,name:o,success:s})})}n.createMenu(function(r){function p(){c.click(function(n){s.children().removeClass("selected");h.children().removeClass("selected");f.addClass("selected");c.addClass("selected");n.preventDefault()});l.click(function(t){s.children().removeClass("selected");h.children().removeClass("selected");e.addClass("selected");l.addClass("selected");t.preventDefault();n.placeholder&&e.find("input[type=text]").focus()});c.click()}function w(){s.remove();f.remove();e.addClass("selected")}var a="img",c,l,f,e;if(r(a)){var u=this,y=u.config.lang,o=new n.Menu({editor:u,id:a,title:y.img}),v=t('<div class="panel-tab"><\/div>'),s=t('<div class="tab-container"><\/div>'),h=t('<div class="content-container"><\/div>');v.append(s).append(h);c=t('<a href="#">上传图片<\/a>');l=t('<a href="#">网络图片<\/a>');s.append(c).append(l);f=t('<div class="content"><\/div>');h.append(f);e=t('<div class="content"><\/div>');h.append(e);i(u,o,e);o.dropPanel=new n.DropPanel(u,o,{$content:v,width:400,onRender:function(){var n=u.config.customUploadInit;n&&n.call(u)}});u.menus[a]=o;u.ready(function(){function u(){o.dropPanel.hide()}var n=this,t=n.config,i=t.uploadImgUrl,r=t.customUpload;i||r?(n.$uploadContent=f,p()):w();f.click(function(){setTimeout(u)})})}})}),t(function(n,t){n.createMenu(function(i){var o="video";if(i(o)){var u=this,f=u.config.lang,w=/^<(iframe)|(embed)/i,r=new n.Menu({editor:u,id:o,title:f.video}),s=t("<div><\/div>"),h=t('<div style="margin:20px 10px;"><\/div>'),e=t('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen><\/iframe>\'/>');h.append(e);var c=t('<div style="margin:20px 10px;"><\/div>'),l=t('<input type="text" value="640" style="width:50px;text-align:center;"/>'),a=t('<input type="text" value="498" style="width:50px;text-align:center;"/>');c.append("<span> "+f.width+" <\/span>").append(l).append("<span> px &nbsp;&nbsp;&nbsp;<\/span>").append("<span> "+f.height+" <\/span>").append(a).append("<span> px <\/span>");var v=t("<div><\/div>"),b=t('<a href="http://www.m1world.com" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？<\/a>'),y=t('<button class="right">'+f.submit+"<\/button>"),p=t('<button class="right gray">'+f.cancel+"<\/button>");v.append(b).append(y).append(p);s.append(h).append(c).append(v);p.click(function(n){n.preventDefault();e.val("");r.dropPanel.hide()});y.click(function(n){n.preventDefault();var i=t.trim(e.val()),f,s=parseInt(l.val()),h=parseInt(a.val()),c=t("<div>"),o='<p style="text-align:center;">{content}<\/p>';if(!i){r.dropPanel.focusFirstInput();return}if(!w.test(i)){alert("视频链接格式错误！");r.dropPanel.focusFirstInput();return}if(isNaN(s)||isNaN(h)){alert("宽度或高度不是数字！");return}f=t(i);f.attr("width",s).attr("height",h);o=o.replace("{content}",c.append(f).html());u.command(n,"insertHtml",o);e.val("")});r.dropPanel=new n.DropPanel(u,r,{$content:s,width:400});u.menus[o]=r}})}),t(function(n,t){var r=function(n){return"onkeyup"in n}(document.createElement("input")),i;n.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas";i=1;n.createMenu(function(u){function b(){e.val("")}var v="location",f,y,h,e,p,a,w;if(u(v)){if(i++>1){n.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单");return}var o=this,k=o.config,s=k.lang,d=k.mapAk;o.mapData={};f=o.mapData;f.markers=[];f.mapContainerId="map"+n.random();f.clearLocations=function(){var n=f.map;n&&(n.clearOverlays(),f.markers=[])};f.searchMap=function(){var n=f.map;if(n){var u=window.BMap,i=c.val(),t=e.val(),o,r;i!==""&&(t&&t!==""||n.centerAndZoom(i,11),t&&t!==""&&(o=new u.Geocoder,o.getPoint(t,function(t){t?(n.centerAndZoom(t,13),r=new u.Marker(t),n.addOverlay(r),r.enableDragging(),f.markers.push(r)):n.centerAndZoom(i,11)},i)))}};y=!1;window.baiduMapCallBack=function(){function o(i){var s=i.name,u,o;if(t.setCenter(s),c.val(s),n.placeholder&&e.focus(),r){o=function(n){n.type==="keyup"&&n.keyCode===13&&n.preventDefault();u&&clearTimeout(u);u=setTimeout(f.searchMap,500)};c.on("keyup change paste",o);e.on("keyup change paste",o)}else o=function(){if(!l.is(":visible")){clearTimeout(u);return}var n="",t="",i=c.val(),r=e.val();(i!==n||r!==t)&&(f.searchMap(),n=i,t=r);u&&clearTimeout(u);u=setTimeout(o,1e3)},u=setTimeout(o,1e3)}var i,t,u;y||(y=!0,i=window.BMap,f.map||(f.map=new i.Map(f.mapContainerId)),t=f.map,t.centerAndZoom(new i.Point(116.404,39.915),11),t.addControl(new i.MapTypeControl),t.setCurrentCity("北京"),t.enableScrollWheelZoom(!0),u=new i.LocalCity,u.get(o),t.addEventListener("click",function(n){var r=new i.Marker(new i.Point(n.point.lng,n.point.lat));t.addOverlay(r);r.enableDragging();f.markers.push(r)},!1))};f.loadMapScript=function(){var t=document.createElement("script");t.type="text/javascript";t.src="http://api.map.baidu.com/api?v=2.0&ak="+d+"&callback=baiduMapCallBack";try{document.body.appendChild(t)}catch(i){n.error("加载地图过程中发生错误")}};f.initMap=function(){window.BMap?window.baiduMapCallBack():f.loadMapScript()};h=new n.Menu({editor:o,id:v,title:s.location});o.menus[v]=h;var l=t("<div><\/div>"),g=t('<div style="margin:10px 0;"><\/div>'),c=t('<input type="text"/>');c.css({width:"80px","text-align":"center"});e=t('<input type="text"/>');e.css({width:"300px","margin-left":"10px"}).attr("placeholder",s.searchlocation);p=t('<button class="right link">'+s.clearLocation+"<\/button>");g.append(p).append(c).append(e);l.append(g);p.click(function(n){e.val("");e.focus();f.clearLocations();n.preventDefault()});a=t('<div id="'+f.mapContainerId+'"><\/div>');a.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});w=t("<span>"+s.loading+"<\/span>");w.css({position:"absolute",width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"});a.append(w);l.append(a);var nt=t('<div style="margin:10px 0;"><\/div>'),tt=t('<button class="right">'+s.submit+"<\/button>"),it=t('<button class="right gray">'+s.cancel+"<\/button>"),rt=t('<label style="display:inline-block;margin-top:10px;color:#666;"><\/label>'),ut=t('<input type="checkbox">');rt.append(ut).append('<span style="display:inline-block;margin-left:5px;">  '+s.dynamicMap+"<\/span>");nt.append(rt).append(tt).append(it);l.append(nt);it.click(function(n){n.preventDefault();b();h.dropPanel.hide()});tt.click(function(n){n.preventDefault();var u=f.map,c=ut.is(":checked"),e=f.markers,l=u.getCenter(),p=l.lng,w=l.lat,k=u.getZoom(),a=u.getSize(),v=a.width,y=a.height,h,i,r;if(i=c?"http://ueditor.baidu.com/ueditor/dialogs/map/show.html#":"http://api.map.baidu.com/staticimage?",i=i+"center="+p+","+w+"&zoom="+k+"&width="+v+"&height="+y,e.length>0&&(i=i+"&markers=",t.each(e,function(n,t){h=t.getPosition();n>0&&(i=i+"|");i=i+h.lng+","+h.lat})),c){if(e.length>1){alert(s.langDynamicOneLocation);return}i+="&markerStyles=l,A";r='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+v+'" height="'+y+'"><\/iframe>';r=r.replace("{src}",i);o.command(n,"insertHtml",r,b)}else o.command(n,"insertHtml",'<img style="max-width:100%;" src="'+i+'"/>',b)});h.dropPanel=new n.DropPanel(o,h,{$content:l,width:500});h.onRender=function(){d===n.baiduMapAk&&n.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+n.docsite)};h.clickEvent=function(){var i=this,n=i.dropPanel,t=!1;if(n.isShowing){n.hide();return}f.map||(t=!0);f.initMap();n.show();t||e.focus()}}})}),t(function(n,t){function i(){if(!(n.userAgent.indexOf("MSIE 8")>0)){var t=document.createElement("script");t.type="text/javascript";t.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js";document.body.appendChild(t)}}n.createMenu(function(r){function a(n){var r=t("<div><\/div>"),i;r.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"});o.css({width:"100%",height:"100%",padding:"10px"});o.on("keydown",function(n){n.keyCode===9&&n.preventDefault()});r.append(o);n.append(r);var s=t("<div><\/div>"),l=t('<button class="right">'+h.submit+"<\/button>"),a=t('<button class="right gray">'+h.cancel+"<\/button>");s.append(l).append(a).append(f);n.append(s);a.click(function(n){n.preventDefault();e.dropPanel.hide()});i='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}<\/code><\/pre>';l.click(function(n){function w(){var n;h&&(n=a.attr("class"),n!==h+" hljs"&&a.attr("class",h+" hljs"));a.html(r)}function b(){u.restoreSelectionByElem(s);y()}var r,l,p,s,a;if(n.preventDefault(),r=o.val(),!r){o.focus();return}l=u.getRangeElem();t.trim(t(l).text())&&(i="<p><br><\/p>"+i);var h=f?f.val():"",v="",y=function(){c.find("pre code").each(function(n,i){var r=t(i);r.attr("codemark")||window.hljs&&(window.hljs.highlightBlock(i),r.attr("codemark","1"))})};if(h&&(v=' class="'+h+' hljs"'),r=r.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;"),!e.selected){p=i.replace("{#langClass}",v).replace("{#content}",r);u.command(n,"insertHtml",p,y);return}(s=u.getSelfOrParentByName(l,"pre"),s&&(s=u.getSelfOrParentByName(l,"code")),s)&&(a=t(s),u.customCommand(n,w,b))})}function v(){var n=u.getRangeElem(),t=u.getSelfOrParentByName(n,"code");t?u.disableMenusExcept("insertcode"):u.enableMenusExcept("insertcode")}var s="insertcode";if(r(s)){setTimeout(i,0);var u=this,h=u.config.lang,c=u.txt.$txt,e=new n.Menu({editor:u,id:s,title:h.insertcode});e.clickEvent=function(){var r=this,i=r.dropPanel,n;if(i.isShowing){i.hide();return}if(o.val(""),i.show(),n=window.hljs,n&&n.listLanguages){if(f.children().length!==0)return;f.css({"margin-top":"9px","margin-left":"5px"});t.each(n.listLanguages(),function(n,t){f.append('<option value="'+t+'">'+t+"<\/option>")})}else f.hide()};e.clickEventSelected=function(){var h=this,i=h.dropPanel,r,n,e,s;if(i.isShowing){i.hide();return}(i.show(),r=u.getRangeElem(),n=u.getSelfOrParentByName(r,"pre"),n&&(n=u.getSelfOrParentByName(r,"code")),n)&&(e=t(n),o.val(e.text()),f&&(s=e.attr("class"),s&&f.val(s.split(" ")[0])))};e.updateSelectedEvent=function(){var i=this,t=i.editor,n;return(n=t.getRangeElem(),n=t.getSelfOrParentByName(n,"pre"),n)?!0:!1};var l=t("<div><\/div>"),o=t("<textarea><\/textarea>"),f=t("<select><\/select>");a(l);e.dropPanel=new n.DropPanel(u,e,{$content:l,width:500});u.menus[s]=e;c.on("keydown",function(n){if(n.keyCode===13){var t=u.getRangeElem(),i=u.getSelfOrParentByName(t,"code");i&&u.command(n,"insertHtml","\n")}});c.on("keydown click",function(){setTimeout(v)})}})}),t(function(n){n.createMenu(function(t){var r="undo";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.undo});u.clickEvent=function(){i.undo()};i.menus[r]=u;i.ready(function(){function i(){n.undoRecord()}var n=this,r=n.txt.$txt,t;r.on("keydown",function(r){var u=r.keyCode;if(r.ctrlKey&&u===90){n.undo();return}u===13?i():(t&&clearTimeout(t),t=setTimeout(i,1e3))});n.undoRecord()})}})}),t(function(n){n.createMenu(function(t){var r="redo";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.redo});u.clickEvent=function(){i.redo()};i.menus[r]=u}})}),t(function(n){var t;n.createMenu(function(i){var e="fullscreen";if(i(e)){var r=this,u=r.txt.$txt,s=r.config,l=s.zindex||1e4,a=s.lang,o=!1,h,c,f=new n.Menu({editor:r,id:e,title:a.fullscreen});f.clickEvent=function(){var i=r.$editorContainer,f,e,s,a;i.addClass("JEditor-fullscreen");h=i.css("z-index");i.css("z-index",l);e=u.height();s=u.outerHeight();r.useMaxHeight&&(c=u.css("max-height"),u.css("max-height","none"),f=u.parent(),f.after(u),f.remove(),u.css("overflow-y","auto"));a=r.menuContainer;u.height(n.$window.height()-a.height()-(s-e));r.menuContainer.$menuContainer.attr("style","");o=!0;r.isFullScreen=!0;t=n.$window.scrollTop()};f.clickEventSelected=function(){var i=r.$editorContainer;i.removeClass("JEditor-fullscreen");i.css("z-index",h);r.useMaxHeight?u.css("max-height",c):r.$valueContainer.css("height",r.valueContainerHeight);r.txt.initHeight();o=!1;r.isFullScreen=!1;t!=null&&n.$window.scrollTop(t)};f.updateSelectedEvent=function(){return o};r.menus[e]=f}})}),t(function(n,t){n.fn.renderMenus=function(){var n=this,u=n.menus,f=n.config.menus,e=n.menuContainer,i,r=0;t.each(f,function(n,t){if(t==="|"){r++;return}i=u[t];i&&i.render(r)})}}),t(function(n){n.fn.renderMenuContainer=function(){var n=this,t=n.menuContainer,i=n.$editorContainer;t.render()}}),t(function(n){n.fn.renderTxt=function(){var n=this,t=n.txt;t.render();n.ready(function(){t.initHeight()})}}),t(function(n){n.fn.renderEditorContainer=function(){var n=this,i=n.$valueContainer,r=n.$editorContainer,f=n.txt.$txt,t,u;i===f?(t=n.$prev,u=n.$parent,t&&t.length?t.after(r):u.prepend(r)):(i.after(r),i.hide())}}),t(function(n,t){n.fn.eventMenus=function(){var n=this.menus;t.each(n,function(n,t){t.bindEvent()})}}),t(function(n){n.fn.eventMenuContainer=function(){}}),t(function(n){n.fn.eventTxt=function(){var n=this.txt;n.saveSelectionEvent();n.updateValueEvent();n.updateMenuStyleEvent()}}),t(function(n){n.plugin(function(){var i=this,t=i.config.uploadImgFns;t.onload||(t.onload=function(t){var r,i,u;n.log("上传结束，返回结果为 "+t);r=this;t.indexOf("error|")===0?(n.warn("上传失败："+t.split("|")[1]),alert(t.split("|")[1])):(n.log("上传成功，即将插入编辑区域，结果为："+t),u=JSON.parse(t),t=u.data.fileUrl||"",i=document.createElement("img"),i.onload=function(){var u='<img src="'+t+'" style="max-width:100%;"/>';r.command(null,"insertHtml",u);n.log("已插入图片，地址 "+t);i=null},i.onerror=function(){n.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+t);i=null},i.src=t)});t.ontimeout||(t.ontimeout=function(){n.error("上传图片超时");alert("上传图片超时")});t.onerror||(t.onerror=function(){n.error("上传图片发生错误");alert("上传图片发生错误")})})}),t(function(n,t){window.FileReader&&window.FormData&&n.plugin(function(){function c(t,r){var u=document.createElement("img");u.onload=function(){var f='<img src="'+t+'" style="max-width:100%;"/>';i.command(r,"insertHtml",f);n.log("已插入图片，地址 "+t);u=null};u.onerror=function(){n.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+t);u=null};u.src=t}function l(n){if(n.lengthComputable){var t=n.loaded/n.total;i.showUploadProgress(t*100)}}var i=this,r=i.config,f=r.uploadImgUrl,e=r.uploadTimeout,u=r.uploadImgFns,o=u.onload,s=u.ontimeout,h=u.onerror;f&&(i.xhrUploadImg=function(r){function ft(){a&&clearTimeout(a);u&&u.abort&&u.abort();w.preventDefault();tt&&tt.call(i,u);i.hideUploadProgress()}var w=r.event,y=r.filename||"",p=r.base64,d=r.fileUrl||"",b=r.fileType||"image/png",et=r.name||"JEditor_upload_file",g=r.loadfn||o,nt=r.errorfn||h,tt=r.timeoutfn||s,it=r.uploadKey||"",ut=r.success||function(){},v=i.config.uploadParams||{},rt="png",u,a,k;if(y.indexOf(".")>0?rt=y.slice(y.lastIndexOf(".")-y.length+1):b.indexOf("/")>0&&b.split("/")[1]&&(rt=b.split("/")[1]),n.isOnWebsite){n.log("预览模拟上传");c(p,w);return}u=new XMLHttpRequest;k=new FormData;u.onload=function(){a&&clearTimeout(a);it||g&&g.call(i,u.responseText,u);i.hideUploadProgress();ut(u.responseText,it)};u.onerror=function(){a&&clearTimeout(a);w.preventDefault();nt&&nt.call(i,u);i.hideUploadProgress()};u.upload.onprogress=l;delete v.fileStr;delete v.fileUrl;p?v.fileStr=p.substring(p.indexOf("base64,")+7):d&&(v.fileUrl=d);t.each(v,function(n,t){k.append(n,t)});u.open("POST",f,!0);u.send(k);a=setTimeout(ft,e);n.log("开始上传...并开始超时计算")})})}),t(function(n,t){n.plugin(function(){function h(){f||(f=!0,i.css({top:o+"px"}),u.append(i))}function c(){i.hide();n=null}var r=this,e=r.menuContainer,o=e.height(),u=r.$editorContainer,s=u.width(),i=t('<div class="JEditor-upload-progress"><\/div>'),f=!1,n;r.showUploadProgress=function(t){n&&clearTimeout(n);h();i.show();i.width(t*s/100)};r.hideUploadProgress=function(t){n&&clearTimeout(n);t=t||750;n=setTimeout(c,t)}})}),t(function(n,t){n.plugin(function(){var i=this,f=i.config,e=f.uploadImgUrl,s=f.uploadTimeout,h,r,u,o;e&&(r=i.$uploadContent,r)&&(u=t('<div class="upload-icon-container"><span class="upload-icon-button"><i class="jeditor-icon-upload"><\/i> 上传本地图片<\/span><\/div>'),r.append(u),o=new n.UploadFile({editor:i,uploadUrl:e,timeout:s,fileAccept:"image/*"}),u.click(function(n){h=n;o.selectFiles()}))})}),t(function(n,t){if(window.FileReader&&window.FormData){var i=function(n){this.editor=n.editor;this.uploadUrl=n.uploadUrl;this.timeout=n.timeout;this.fileAccept=n.fileAccept;this.multiple=n.multipe===undefined?!0:n.multipe;this.xhrUpload=n.xhrUpload||this.editor.xhrUploadImg;this.uploadFns=n.uploadFns||this.editor.config.uploadImgFns};i.fn=i.prototype;i.fn.clear=function(){this.$input.val("");n.log("input value 已清空")};i.fn.render=function(){var i=this;if(!i._hasRender){n.log("渲染dom");var u=i.fileAccept,e=u?'accept="'+u+'"':"",o=i.multiple,s=o?'multiple="multiple"':"",r=t('<input type="file" '+e+" "+s+"/>"),f=t('<div style="visibility:hidden;"><\/div>');f.append(r);n.$body.append(f);r.on("change",function(n){i.selected(n,r.get(0))});i.$input=r;i._hasRender=!0}};i.fn.selectFiles=function(){var t=this;n.log("使用 html5 方式上传");t.render();n.log("选择文件");t.$input.click()};i.fn.selected=function(i,r){var f=this,e=!1,u=r.files||[];u.length!==0&&(n.log("选中 "+u.length+" 个文件"),t.each(u,function(t,i){var r=n.config.uploadImageMaxSize/1048576,s=r/1048576,u=i.type,o=(i.size/1048576).toFixed(2);return u.indexOf("video")>=0&&(r=n.config.uploadVideoMaxSize/1048576,u="视频"),o>r?(e=!0,f.clear(),alert("您上传的图片"+i.name+"大小为："+o+" MB 最大可上传 "+r+" MB"),!1):void 0}),e||t.each(u,function(n,t){f.upload(t)}))};i.fn.upload=function(t){function f(){i.clear()}var i=this,e=i.editor,r=t.name||"",l=t.type||"",u=i.uploadFns||e.config.uploadImgFns,a=e.config.uploadImgFileName||"JEditorH5File",o=u.onload,s=u.ontimeout,h=u.onerror,c=new FileReader;if(!o||!s||!h){n.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件");return}n.log("开始执行 "+r+" 文件的上传");c.onload=function(u){n.log("已读取"+r+"文件");var e=u.target.result||this.result;i.xhrUpload({event:u,filename:r,base64:e,file:t,fileType:l,name:a,loadfn:function(n,t){f();var i=this;o.call(i,n,t)},errorfn:function(t){f();n.isOnWebsite&&alert("JEditor官网暂时没有服务端，因此报错。实际项目中不会发生");var i=this;h.call(i,t)},timeoutfn:function(t){f();n.isOnWebsite&&alert("JEditor官网暂时没有服务端，因此超时。实际项目中不会发生");var i=this;s(i,t)}})};c.readAsDataURL(t)};n.UploadFile=i}}),t(function(n,t){if(!window.FileReader||!window.FormData){var i=function(n){this.editor=n.editor;this.uploadUrl=n.uploadUrl;this.timeout=n.timeout;this.fileAccept=n.fileAccept;this.multiple=n.multipe===undefined?!0:n.multipe};i.fn=i.prototype;i.fn.clear=function(){this.$input.val("");n.log("input value 已清空")};i.fn.hideModal=function(){this.modal.hide()};i.fn.render=function(){var i=this,r=i.editor,l=r.config.uploadImgFileName||"JEditorFormFile",o,c;if(!i._hasRender){o=i.uploadUrl;n.log("渲染dom");var u="iframe"+n.random(),s=t('<iframe name="'+u+'" id="'+u+'" frameborder="0" width="0" height="0"><\/iframe>'),a=i.multiple,v=a?'multiple="multiple"':"",y=t("<p>选择图片并上传<\/p>"),h=t('<input type="file" '+v+' name="'+l+'"/>'),p=t('<input type="submit" value="上传"/>'),f=t('<form enctype="multipart/form-data" method="post" action="'+o+'" target="'+u+'"><\/form>'),e=t('<div style="margin:10px 20px;"><\/div>');f.append(y).append(h).append(p);t.each(r.config.uploadParams,function(n,i){f.append(t('<input type="hidden" name="'+n+'" value="'+i+'"/>'))});e.append(f);e.append(s);i.$input=h;i.$iframe=s;c=new n.Modal(r,undefined,{$content:e});i.modal=c;i._hasRender=!0}};i.fn.bindLoadEvent=function(){function u(){var i=t.trim(e.document.body.innerHTML);i&&(o.call(r,i),n.clear(),n.hideModal())}var n=this;if(!n._hasBindLoad){var r=n.editor,f=n.$iframe,i=f.get(0),e=i.contentWindow,o=n.uploadFns.onload||r.config.uploadImgFns.onload;i.attachEvent?i.attachEvent("onload",u):i.onload=u;n._hasBindLoad=!0}};i.fn.show=function(){function i(){t.show();n.bindLoadEvent()}var n=this,t=n.modal;setTimeout(i)};i.fn.selectFiles=function(){var t=this;n.log("使用 form 方式上传");t.render();t.clear();t.show()};n.UploadFile=i}}),t(function(n,t){n.plugin(function(){function c(){var e=/^data:(image\/\w+);base64/,s=u.find("img");n.log("粘贴后，检查到编辑器有"+s.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片");t.each(s,function(){var s=this,h=t(s),c,u=h.attr("src"),l;(f.each(function(){if(s===this)return c=!0,!1}),c)||(n.log("找到一个粘贴过来的图片"),e.test(u)?(n.log("src 是 base64 格式，可以上传"),l=u.match(e)[1],r.xhrUploadImg({event:i,base64:u,fileType:l,name:o})):n.log("src 为 "+u+" ，不是 base64 格式，暂时不支持上传"),h.remove())});n.log("遍历结束")}var r=this,s=r.txt,u=s.$txt,e=r.config,h=e.uploadImgUrl,o=e.uploadImgFileName||"JEditorPasteFile",i,f;if(h)u.on("paste",function(e){var s,v,h,l,a;i=e;s=i.clipboardData||i.originalEvent.clipboardData;v=s==null?window.clipboardData&&window.clipboardData.getData("text"):s.getData("text/plain")||s.getData("text/html");h=s&&s.items;h?(l=0,h.length===2&&(l=1),a=h[l].getAsFile(),a!=null&&e.preventDefault(),n.log("通过 data.items 得到了数据"),t.each(h,function(t,u){var e=u.type||"",s,f;e.indexOf("image")<0||(s=u.getAsFile(),f=new FileReader,n.log("得到一个粘贴图片"),f.onload=function(t){n.log("读取到粘贴的图片");var u=t.target.result||this.result;r.xhrUploadImg({event:i,base64:u,fileType:e,name:o})},f.readAsDataURL(s))})):(n.log("未从 data.items 得到数据，使用检测粘贴图片的方式"),f=u.find("img"),n.log("粘贴前，检查到编辑器有"+f.length+"个图片"),setTimeout(c,0))})})}),t(function(n,t){n.plugin(function(){var i=this,u=i.txt,f=u.$txt,r=i.config,e=r.uploadImgUrl,o=r.uploadImgFileName||"JEditorDragFile";if(e){n.$document.on("dragleave drop dragenter dragover",function(n){n.preventDefault()});f.on("drop",function(r){r.preventDefault();var f=r.originalEvent,u=f.dataTransfer&&f.dataTransfer.files;u&&u.length&&t.each(u,function(t,u){var e=u.type,s=u.name,f;e.indexOf("image/")<0||(n.log("得到图片 "+s),f=new FileReader,f.onload=function(t){n.log("读取到图片 "+s);var u=t.target.result||this.result;i.xhrUploadImg({event:r,base64:u,fileType:e,name:o})},f.readAsDataURL(u))})})}})}),t(function(n,t){n.plugin(function(){function p(){c||(w(),r.append(o).append(l).append(a).append(v),u.$editorContainer.append(r),c=!0)}function w(){function t(t,i){n&&u.customCommand(t,n,i)}var n;l.click(function(r){n=function(){i.remove()};t(r,function(){setTimeout(f,100)})});v.click(function(r){n=function(){i.css({width:"100%"})};t(r,function(){setTimeout(s)})});a.click(function(r){n=function(){i.css({width:"auto"})};t(r,function(){setTimeout(s)})})}function s(){var c;if(!u._disabled&&i!=null){i.addClass("clicked");var f=i.position(),l=f.top,a=f.left,v=i.outerHeight(),y=i.outerWidth(),n=l+v,p=a,t=0,s=e.position().top,h=e.outerHeight();n>s+h&&(n=s+h);r.show();c=r.outerWidth();t=y/2-c/2;r.css({top:n+5,left:p,"margin-left":t});t<0?(r.css("margin-left","0"),o.hide()):o.show()}}function f(){i!=null&&(i.removeClass("clicked"),i=null,r.hide())}var u=this,y=u.txt,h=y.$txt,e=u.useMaxHeight?h.parent():h,i,c=!1,r=t('<div class="txt-toolbar"><\/div>'),o=t('<div class="tip-triangle"><\/div>'),l=t('<a href="#"><i class="jeditor-icon-trash-o"><\/i><\/a>'),a=t('<a href="#"><i class="jeditor-icon-search-minus"><\/i><\/a>'),v=t('<a href="#"><i class="jeditor-icon-search-plus"><\/i><\/a>');e.on("click","table",function(n){var r=t(n.currentTarget);if(p(),i&&i.get(0)===r.get(0)){setTimeout(f,100);return}i=r;s();n.preventDefault();n.stopPropagation()}).on("click keydown scroll",function(){setTimeout(f,100)});n.$body.on("click keydown scroll",function(){setTimeout(f,100)})})}),t(function(n,t){n.userAgent.indexOf("MSIE 8")>0||n.plugin(function(){function l(n,u){if(i){var e,c=function(){u!=null&&(o=u)},f,s=!1,h=i.parent();if(h.get(0).nodeName.toLowerCase()==="a"?(f=h,s=!0):f=t('<a target="_blank"><\/a>'),u==null)return f.attr("href")||"";if(u==="")s&&(e=function(){i.unwrap()});else{if(u===o)return;e=function(){f.attr("href",u);s||i.wrap(f)}}e&&r.customCommand(n,e,c)}}function ht(){k||(ct(),lt(),s.append(d).append(g).append(nt).append(tt).append(it).append(rt),h.append(c).append(ft).append(ut),e.append(v).append(s).append(h),r.$editorContainer.append(e).append(u),k=!0)}function ct(){function u(t,i){n&&r.customCommand(t,n,i)}var n;d.click(function(t){l(t,"");n=function(){i.remove()};u(t,function(){setTimeout(f,100)})});nt.click(function(t){n=function(){var r=i.get(0),n=r.width,t=r.height;n=n*1.1;t=t*1.1;i.css({width:n+"px",height:t+"px"})};u(t,function(){setTimeout(p)})});g.click(function(t){n=function(){var r=i.get(0),n=r.width,t=r.height;n=n*.9;t=t*.9;i.css({width:n+"px",height:t+"px"})};u(t,function(){setTimeout(p)})});tt.click(function(t){n=function(){i.parent().css({"text-align":"left"}).attr("align","left")};u(t,function(){setTimeout(f,100)})});rt.click(function(t){n=function(){i.parent().css({"text-align":"right"}).attr("align","right")};u(t,function(){setTimeout(f,100)})});it.click(function(t){n=function(){i.parent().css({"text-align":"center"}).attr("align","center")};u(t,function(){setTimeout(f,100)})});ot.click(function(n){n.preventDefault();o=l(n);c.val(o);s.hide();h.show()});ut.click(function(n){n.preventDefault();var i=t.trim(c.val());i&&l(n,i);setTimeout(f)});ft.click(function(n){n.preventDefault();c.val(o);s.show();h.hide()});st.click(function(n){n.preventDefault();l(n,"");setTimeout(f)})}function lt(){function l(n){var f,e,l,a,v,y;f=n.pageX-o;e=n.pageY-s;l=t+f;a=r+e;u.css({"margin-left":l,"margin-top":a});v=h+f;y=c+e;i&&i.css({width:v,height:y})}var o,s,t,r,h,c;u.on("mousedown",function(a){if(i){o=a.pageX;s=a.pageY;t=parseFloat(u.css("margin-left"),10);r=parseFloat(u.css("margin-top"),10);h=i.width();c=i.height();e.hide();n.$document.on("mousemove._dragResizeImg",l);n.$document.on("mouseup._dragResizeImg",function(){n.$document.off("mousemove._dragResizeImg");n.$document.off("mouseup._dragResizeImg");f();u.css({"margin-left":t,"margin-top":r});y=!1});y=!0}})}function p(){var p;if(!r._disabled&&i!=null){i.addClass("clicked");var f=i.position(),o=f.top,s=f.left,h=i.outerHeight(),c=i.outerWidth();u.css({top:o+h,left:s+c});var n=o+h,w=s,t=0,l=a.position().top,y=a.outerHeight();n>l+y?n=l+y:u.show();e.show();p=e.outerWidth();t=c/2-p/2;e.css({top:n+5,left:w,"margin-left":t});t<0?(e.css("margin-left","0"),v.hide()):v.show();r.disableMenusExcept()}}function f(){i!=null&&(i.removeClass("clicked"),i=null,e.hide(),u.hide(),r.enableMenusExcept())}function at(n){var i=!1;return r.emotionUrls?(t.each(r.emotionUrls,function(t,r){var u=!1;return n===r&&(i=!0,u=!0),u?!1:void 0}),i):i}var r=this,w=r.config.lang,et=r.txt,b=et.$txt,a=r.useMaxHeight?b.parent():b,vt=r.$editorContainer,i,o="",k=!1,u=t('<div class="img-drag-point"><\/div>'),e=t('<div class="txt-toolbar"><\/div>'),v=t('<div class="tip-triangle"><\/div>'),s=t("<div><\/div>"),d=t('<a href="#"><i class="jeditor-icon-trash-o"><\/i><\/a>'),g=t('<a href="#"><i class="jeditor-icon-search-minus"><\/i><\/a>'),nt=t('<a href="#"><i class="jeditor-icon-search-plus"><\/i><\/a>'),tt=t('<a href="#"><i class="jeditor-icon-align-left"><\/i><\/a>'),it=t('<a href="#"><i class="jeditor-icon-align-center"><\/i><\/a>'),rt=t('<a href="#"><i class="jeditor-icon-align-right"><\/i><\/a>'),ot=t('<a href="#"><i class="jeditor-icon-link"><\/i><\/a>'),st=t('<a href="#"><i class="jeditor-icon-unlink"><\/i><\/a>'),h=t('<div style="display:none;"><\/div>'),c=t('<input type="text" style="height:26px; margin-left:10px; width:200px;"/>'),ut=t('<button class="right">'+w.submit+"<\/button>"),ft=t('<button class="right gray">'+w.cancel+"<\/button>"),y=!1;a.on("mousedown","img",function(n){n.preventDefault()}).on("click","img",function(n){var r=t(n.currentTarget),u=r.attr("src");if(u&&!at(u)){if(ht(),i&&i.get(0)===r.get(0)){setTimeout(f,100);return}i=r;p();s.show();h.hide();n.preventDefault();n.stopPropagation()}}).on("click keydown scroll",function(){y||setTimeout(f,100)})})}),t(function(n,t){n.plugin(function(){function y(){c||(i.append(v).append(h),f.$editorContainer.append(i),c=!0)}function p(){if(n){var t=n.position(),r=t.left,u=t.top,f=n.height();i.css({top:u+f+5,left:r})}}function w(){if(!u&&n){y();i.show();var t=n.attr("href");h.attr("href",t);p();u=!0}}function s(){u&&n&&(i.hide(),u=!1)}var f=this,l=f.config.lang,a=f.txt.$txt,n,i=t('<div class="txt-toolbar"><\/div>'),v=t('<div class="tip-triangle"><\/div>'),h=t('<a href="#" target="_blank"><i class="jeditor-icon-link"><\/i> '+l.openLink+"<\/a>"),c,u=!1,e,r,o;a.on("mouseenter","a",function(i){e&&clearTimeout(e);e=setTimeout(function(){var r=i.currentTarget;n=t(r);w()},500)}).on("mouseleave","a",function(){r&&clearTimeout(r);r=setTimeout(s,500)}).on("click keydown scroll",function(){setTimeout(s,100)});i.on("mouseenter",function(){r&&clearTimeout(r)}).on("mouseleave",function(){o&&clearTimeout(o);o=setTimeout(s,500)})})}),t(function(n){n.plugin(function(){var t=this,u=t.config.menuFixed,r;if(u!==!1&&typeof u=="number"){r=parseFloat(n.$body.css("margin-top"),10);isNaN(r)&&(r=0);var f=t.$editorContainer,s=f.offset().top,h=f.outerHeight(),i=t.menuContainer.$menuContainer,c=i.css("position"),l=i.css("top"),e,o=i.outerHeight(),a=i.offset().top,v=t.txt.$txt;n.$window.scroll(function(){if(!t.isFullScreen){e=i.width();var f=n.$window.scrollTop();f>=a&&f+u+o+30<s+h?(i.css({position:"fixed",top:u}),i.width(e),n.$body.css({"margin-top":r+o}),t._isMenufixed||(t._isMenufixed=!0)):(i.css({position:c,top:l}),i.css("width","100%"),n.$body.css({"margin-top":r}),t._isMenufixed&&(t._isMenufixed=!1))}})}})}),t(function(n,t){n.createMenu(function(i){var f="indent",r,u;i(f)&&(r=this,u=new n.Menu({editor:r,id:f,title:"缩进",$domNormal:t('<a href="#" tabindex="-1"><i class="jeditor-icon-indent-left"><\/i><\/a>'),$domSelected:t('<a href="#" tabindex="-1" class="selected"><i class="jeditor-icon-indent-left"><\/i><\/a>')}),u.clickEvent=function(n){function e(){u.css("text-indent","2em")}var f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"p"),u;if(!i)return n.preventDefault();u=t(i);r.customCommand(n,e)},u.clickEventSelected=function(n){function e(){u.css("text-indent","0")}var f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"p"),u;if(!i)return n.preventDefault();u=t(i);r.customCommand(n,e)},u.updateSelectedEvent=function(){var f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"p"),u,n;return i?(u=t(i),n=u.css("text-indent"),!n||n==="0px")?!1:!0:!1},r.menus[f]=u)})}),t(function(n,t){n.createMenu(function(i){var u="lineheight",r;if(i(u)){r=this;r.commandHooks.lineHeight=function(n){var u=r.getRangeElem(),i=r.getSelfOrParentByName(u,"p,h1,h2,h3,h4,h5,pre");i&&t(i).css("line-height",n+"")};var f=new n.Menu({editor:r,id:u,title:"行高",commandName:"lineHeight",$domNormal:t('<a href="#" tabindex="-1"><i class="jeditor-icon-arrows-v"><\/i><\/a>'),$domSelected:t('<a href="#" tabindex="-1" class="selected"><i class="jeditor-icon-arrows-v"><\/i><\/a>')});f.dropList=new n.DropList(r,f,{data:{"1.0":"1.0倍","1.5":"1.5倍","1.8":"1.8倍","2.0":"2.0倍","2.5":"2.5倍","3.0":"3.0倍"},tpl:'<span style="line-height:{#commandValue}">{#title}<\/span>'});r.menus[u]=f}})}),t(function(n,t){n.plugin(function(){var i=this,o=i.config.customUpload,r,u,f,e;if(o){if(i.config.uploadImgUrl){alert("自定义上传无效，详看浏览器日志console.log");n.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。");return}}else return;r=i.$uploadContent;r||n.error("自定义上传，无法获取 editor.$uploadContent");u=t('<a href="#" class="upload-icon-container"><i class="jeditor-icon-upload"><\/i><\/a>');r.append(u);f="upload"+n.random();e="upload"+n.random();u.attr("id",f);r.attr("id",e);i.customUploadBtnId=f;i.customUploadContainerId=e})}),t(function(n){n.info("本页面富文本编辑器由 JEditor 提供 http:// ")}),window.JEditor}),function(n){var t=window.JEditor;t.createMenu(function(i){function p(){o.click(function(){u.addClass("selected").siblings().removeClass("selected");o.addClass("selected").siblings().removeClass("selected")});s.click(function(){f.addClass("selected").siblings().removeClass("selected");s.addClass("selected").siblings().removeClass("selected");t.placeholder&&f.find(".network-container input[type=text]").focus()});o.click()}function w(){c.hide();u.hide();f.addClass("selected")}function b(n){var t={youku:{name:"youku",domain:".youku.com",videoUrl:"http://player.youku.com/embed/{{video_id}}"},tudou:{name:"tudou",domain:".tudou.com",videoUrl:"http://www.tudou.com/programs/view/html5embed.action?code={{code}}&lcode={{lcode}}"}},u="",e="",i,r,o,s,f,h,c;for(var l in t)if(n.indexOf(t[l].domain)>=0){e=t[l].name;break}switch(e){case t.youku.name:i=n.indexOf("/id_")+4;r=n.indexOf(".html");o=n.substring(i,r);u=t.youku.videoUrl.replace("{{video_id}}",o);break;case t.tudou.name:i=n.indexOf("http://")+7;r=n.lastIndexOf(".html");s=n.substring(i,r);f=s.split("/");h=f[3];c=f[2];u=t.tudou.videoUrl.replace("{{code}}",h).replace("{{lcode}}",c)}return u}function k(n){return["v.youku.com","www.tudou.com"].some(function(t){return n.indexOf(t)>=0})}function d(t){var i,r;return/^<(iframe)|(embed)/i.test(t)?(r=n(t),i=r.attr("src")):i=k(t)?b(t):t,i}function g(t,i,r){function p(){u.val("")}var s=t.config.lang,v=n('<div class="network-container"><\/div>'),u=n('<input type="text" class="block" placeholder="腾讯视频支持粘贴通用代码,其他视频网站支持网址和通用代码">'),c,f,l,a,h;v.append(u);c=n('<span><i class="wangeditor-menu-img-video-camera"><\/i> 视频预览<\/span>');f=n('<div class="content-preview" style="height: 200px;"><\/div>');f.append(c);var y=n('<div style="margin:20px 10px;"><\/div>'),e=n('<input type="text" value="640" style="width:50px;text-align:center;"/>'),o=n('<input type="text" value="498" style="width:50px;text-align:center;"/>');y.append("<span> "+s.width+" <\/span>").append(e).append("<span> px &nbsp;&nbsp;&nbsp;<\/span>").append("<span> "+s.height+" <\/span>").append(o).append("<span> px <\/span>");l=n('<button class="right">'+s.submit+"<\/button>");a=n('<button class="right gray">'+s.cancel+"<\/button>");r.append(v,f,y,l,a);h="";u.bind("input propertychange",function(){var i=n.trim(n(this).val()),t;h=d(i);t='<iframe src="'+h+'" width="100%" height="100%" frameborder=0 allowfullscreen/>';f.empty().append(t)});e.bind("input propertychange",function(){var t=n.trim(e.val());e.val(t.replace(/[^\d]/g,""))});o.bind("input propertychange",function(){var n=o.val();o.val(n.replace(/[^\d]/g,""))});a.click(function(n){n.preventDefault();i.dropPanel.hide()});l.click(function(i){var r;i.preventDefault();var s=n.trim(u.val()),l=n.trim(e.val())||640,a=n.trim(o.val())||498;if(!s){u.focus();return}r='<iframe src="'+h+'" width="'+l+'" height="'+a+'" frameborder=0 allowfullscreen/>';t.command(i,"insertHtml",r,p);u.val("");f.empty().append(c)})}var h="video",o,s,u,f;if(i(h)){var r=this,v=r.config.lang,y=n('<div class="menu-dot" style="display:none;"><\/div>'),e=new t.Menu({editor:r,id:h,title:v.video,$domNormal:n('<a href="#" tabindex="-1"><i class="jeditor-icon-play"><\/i><\/a>'),$domSelected:n('<a href="#" tabindex="-1" class="selected"><i class="jeditor-icon-play"><\/i><\/a>'),$dot:y}),a=n('<div class="panel-tab"><\/div>'),c=n('<div class="tab-container"><\/div>'),l=n('<div class="content-container"><\/div>');a.append(c,l);o=n("<a>上传视频<\/a>");s=n("<a>网络视频<\/a>");c.append(o,s);u=n('<div class="content"><\/div>');l.append(u);f=n('<div class="content"><\/div>');l.append(f);g(r,e,f);e.dropPanel=new t.DropPanel(r,e,{$content:a,width:400,onRender:function(){var n=r.config.customUploadInit;n&&n.call(r)}});r.menus[h]=e;r.ready(function(){var n=this,t=n.config,i=t.uploadImgUrl,r=t.customUpload;i||r?(n.$uploadContentVideo=u,p()):w();u.click(function(){setTimeout(function(){e.dropPanel.show()})})})}});t.plugin(function(){var i=this,n=i.config.uploadVideoFns;n.onload||(n.onload=function(n){var i,r;t.log("上传结束，返回结果为 "+n);i=this;n.indexOf("error|")===0?(t.warn("上传失败："+n.split("|")[1]),alert(n.split("|")[1])):(t.log("上传成功，即将插入编辑区域，结果为："+n),r=JSON.parse(n),n=r.data.fileUrl,i.hideUploadProgressVideo(n),t.log("已插入视频，地址 "+n))});n.ontimeout||(n.ontimeout=function(){t.error("上传视频超时");alert("上传视频超时")});n.onerror||(n.onerror=function(){t.error("上传上视频发生错误");alert("上传上视频发生错误")})});t.plugin(function(){function c(n,r){var u=document.createElement("img");u.onload=function(){var f='<img src="'+n+'" style="max-width:100%;"/>';i.command(r,"insertHtml",f);t.log("已插入视频，地址 "+n);u=null};u.onerror=function(){t.error("使用返回的结果获取视频，发生错误。请确认以下结果是否正确："+n);u=null};u.src=n}function l(n){if(n.lengthComputable){var t=n.loaded/n.total;i.showUploadProgressVideo(t*100)}}if(window.FileReader&&window.FormData){var i=this,r=i.config,f=r.uploadImgUrl,e=r.uploadTimeout,u=r.uploadVideoFns,o=u.onload,s=u.ontimeout,h=u.onerror;f&&(i.xhrUploadVideo=function(r){function it(){a&&clearTimeout(a);u&&u.abort&&u.abort();y.preventDefault();d&&d.call(i,u);i.hideUploadProgressVideo()}var y=r.event,v=r.filename||"",tt=r.base64,p=r.fileType||"video/mp4",rt=r.name||"wangEditor_upload_file",b=r.loadfn||o,k=r.errorfn||h,d=r.timeoutfn||s,g=i.config.uploadParamsVideo||{},nt="mp4",u,a,w;if(v.indexOf(".")>0?nt=v.slice(v.lastIndexOf(".")-v.length+1):p.indexOf("/")>0&&p.split("/")[1]&&(nt=p.split("/")[1]),t.isOnWebsite){t.log("预览模拟上传");c(tt,y);return}u=new XMLHttpRequest;w=new FormData;u.onload=function(){a&&clearTimeout(a);b&&b.call(i,u.responseText,u);i.hideUploadProgressVideo()};u.onerror=function(){a&&clearTimeout(a);y.preventDefault();k&&k.call(i,u);i.hideUploadProgressVideo()};u.upload.onprogress=l;g.file=r.file;n.each(g,function(n,t){w.append(n,t)});u.open("POST",f,!0);u.send(w);a=setTimeout(it,e);i.xhrUploadVideoAbort=function(){a&&clearTimeout(a);u.abort()};t.log("开始上传...并开始超时计算")})}});t.plugin(function(){function a(){c||(c=!0,u=t.find(".upload-progress"),f=t.find(".percentage"),e=t.find(".progress-label"),o=t.find(".complete-preview"),s=i.menus.video.$dot)}var i=this,l=i.menuContainer,v=l.height(),y=i.$editorContainer,t=i.$uploadContentVideo,u,f,e,o,s,h="",c=!1,r;i.showUploadProgressVideo=function(n){r&&clearTimeout(r);a();t.addClass("progress");f.css("width",n+"%");e.text("正在上传...("+parseInt(n)+"%)");s.show().text(parseInt(n)+"%")};i.hideUploadProgressVideo=function(i){if(t.removeClass("progress"),i){h=i;t.addClass("complete");var r=n('<iframe src="'+h+'" width="100%" height="100%" frameborder="0" allowfullscreen/>');o.empty().append(r)}}});t.plugin(function(){var i=this,o=i.config,s=o.uploadImgUrl,b=o.uploadTimeout,r,f,e;if(s&&(r=i.$uploadContentVideo,r)){var h=i.menus.video.$dot,c=n('<div class="upload-progress-container"><\/div>'),l=n('<div class="upload-progress"><\/div>'),k=n('<div class="percentage" style="width:30%"><\/div>'),d=n('<div class="progress-label">正在上传...(30%)<\/div>'),a=n('<a class="btn-upload-cancel">取消<\/a>');l.append(k);c.append(l,d,a);var v=n('<div class="upload-complete-container"><\/div>'),u=n('<div class="complete-preview"><\/div>'),g=n('<div class="complete-label">视频上传完成 100%<\/div>'),y=n('<div class="complete-btns"><\/div>'),p=n('<a class="btn-complete-cancel">取消<\/div>'),w=n('<a class="btn-complete-insert">插入<\/div>');y.append(p,w);v.append(u,g,y);f=n('<div class="upload-icon-container"><span class="upload-icon-button"><i class="wangeditor-menu-img-upload"><\/i> 上传本地视频<\/span><\/div>');r.append(f,c,v);e=new t.UploadFile({editor:i,uploadUrl:s,timeout:b,fileAccept:"video/mp4, video/flv, video/f4v, video/ogg, video/webm, video/m3u8",multipe:!1,xhrUpload:i.xhrUploadVideo,uploadFns:i.config.uploadVideoFns});f.click(function(){e.selectFiles()});a.click(function(n){n.stopPropagation();i.xhrUploadVideoAbort();r.removeClass("progress");h.hide();e.clear();console.log("手动终止上传(点击取消按钮)")});p.click(function(){r.removeClass("complete");h.hide();console.log("取消插入!")});w.click(function(){var n=u.find("iframe").attr("src"),t;n&&(t='<iframe src="'+n+'" style="width:640px; height:498px; max-width:100%;" frameborder=0 allowfullscreen/>',i.command(null,"insertHtml",t),r.removeClass("complete"),u.empty(),i.menus.video.$dot.hide())})}})}(window.jQuery);
/*
//# sourceMappingURL=JEditor.min.js.map
*/